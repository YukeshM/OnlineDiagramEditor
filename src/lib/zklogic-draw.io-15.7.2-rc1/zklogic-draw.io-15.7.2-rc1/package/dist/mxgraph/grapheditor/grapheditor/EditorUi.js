function ChangeGridColor(t,e){this.ui=t,this.color=e}function ChangePageSetup(t,e,i,n,o){this.ui=t,this.color=e,this.previousColor=e,this.image=i,this.previousImage=i,this.format=n,this.previousFormat=n,this.pageScale=o,this.previousPageScale=o,this.ignoreColor=!1,this.ignoreImage=!1}EditorUi=function(t,e,i){mxEventSource.call(this),this.destroyFunctions=[],this.editor=t||new Editor,this.container=e||document.body;var n=this.editor.graph;n.lightbox=i;var o=n.getGraphBounds;if(n.getGraphBounds=function(t){var e=o.apply(this,arguments);if(null!=(t=this.backgroundImage)){var i=this.view.translate,n=this.view.scale;(e=mxRectangle.fromRectangle(e)).add(new mxRectangle((i.x+t.x)*n,(i.y+t.y)*n,t.width*n,t.height*n))}return e},n.useCssTransforms&&(this.lazyZoomDelay=0),mxClient.IS_SVG?mxPopupMenu.prototype.submenuImage="data:image/gif;base64,R0lGODlhCQAJAIAAAP///zMzMyH5BAEAAAAALAAAAAAJAAkAAAIPhI8WebHsHopSOVgb26AAADs=":(new Image).src=mxPopupMenu.prototype.submenuImage,mxClient.IS_SVG||null==mxConnectionHandler.prototype.connectImage||((new Image).src=mxConnectionHandler.prototype.connectImage.src),this.selectionStateListener=mxUtils.bind(this,(function(t,e){this.clearSelectionState()})),n.getSelectionModel().addListener(mxEvent.CHANGE,this.selectionStateListener),n.getModel().addListener(mxEvent.CHANGE,this.selectionStateListener),n.addListener(mxEvent.EDITING_STARTED,this.selectionStateListener),n.addListener(mxEvent.EDITING_STOPPED,this.selectionStateListener),n.getView().addListener("unitChanged",this.selectionStateListener),this.editor.chromeless&&!this.editor.editable&&(this.footerHeight=0,n.isEnabled=function(){return!1},n.panningHandler.isForcePanningEvent=function(t){return!mxEvent.isPopupTrigger(t.getEvent())}),this.actions=new Actions(this),this.menus=this.createMenus(),!n.standalone){var r=["rounded","shadow","glass","dashed","dashPattern","labelBackgroundColor","labelBorderColor","comic","sketch","fillWeight","hachureGap","hachureAngle","jiggle","disableMultiStroke","disableMultiStrokeFill","fillStyle","curveFitting","simplification","sketchStyle","pointerEvents"],l=["shape","edgeStyle","curved","rounded","elbow","jumpStyle","jumpSize","comic","sketch","fillWeight","hachureGap","hachureAngle","jiggle","disableMultiStroke","disableMultiStrokeFill","fillStyle","curveFitting","simplification","sketchStyle"],s=["curved","sourcePerimeterSpacing","targetPerimeterSpacing","startArrow","startFill","startSize","endArrow","endFill","endSize"];this.setDefaultStyle=function(t){try{var e=n.getCellStyle(t,!1),i=[],o=[];for(var r in e)i.push(e[r]),o.push(r);n.getModel().isEdge(t)?n.currentEdgeStyle={}:n.currentVertexStyle={},this.fireEvent(new mxEventObject("styleChanged","keys",o,"values",i,"cells",[t]))}catch(t){this.handleError(t)}},this.clearDefaultStyle=function(){n.currentEdgeStyle=mxUtils.clone(n.defaultEdgeStyle),n.currentVertexStyle=mxUtils.clone(n.defaultVertexStyle),this.fireEvent(new mxEventObject("styleChanged","keys",[],"values",[],"cells",[]))};for(var a=["fontFamily","fontSource","fontSize","fontColor"],d=0;d<a.length;d++)mxUtils.indexOf(r,a[d])<0&&r.push(a[d]);var h=["edgeStyle","startArrow","startFill","startSize","endArrow","endFill","endSize"],c=[["startArrow","startFill","endArrow","endFill"],["startSize","endSize"],["sourcePerimeterSpacing","targetPerimeterSpacing"],["strokeColor","strokeWidth"],["fillColor","gradientColor","gradientDirection"],["opacity"],["html"]];for(d=0;d<c.length;d++)for(var u=0;u<c[d].length;u++)r.push(c[d][u]);for(d=0;d<l.length;d++)mxUtils.indexOf(r,l[d])<0&&r.push(l[d]);var g=function(t,e,i,o,l,a,d){if(o=null!=o?o:n.currentVertexStyle,l=null!=l?l:n.currentEdgeStyle,a=null==a||a,i=null!=i?i:n.getModel(),d){for(var h=[],u=0;u<t.length;u++)h=h.concat(i.getDescendants(t[u]));t=h}i.beginUpdate();try{for(u=0;u<t.length;u++){var g,m=t[u];if(e)g=["fontSize","fontFamily","fontColor"];else{var p=i.getStyle(m),f=null!=p?p.split(";"):[];g=r.slice();for(var x=0;x<f.length;x++){var v=f[x],y=v.indexOf("=");if(y>=0){var E=v.substring(0,y),b=mxUtils.indexOf(g,E);b>=0&&g.splice(b,1);for(var C=0;C<c.length;C++){var S=c[C];if(mxUtils.indexOf(S,E)>=0)for(var w=0;w<S.length;w++){var U=mxUtils.indexOf(g,S[w]);U>=0&&g.splice(U,1)}}}}}var T=i.isEdge(m),M=T?l:o,P=i.getStyle(m);for(x=0;x<g.length;x++){var k=M[E=g[x]];null==k||"edgeStyle"==E||"shape"==E&&!T||(!T||a||mxUtils.indexOf(s,E)<0)&&(P=mxUtils.setStyle(P,E,k))}Editor.simpleLabels&&(P=mxUtils.setStyle(mxUtils.setStyle(P,"html",null),"whiteSpace",null)),i.setStyle(m,P)}}finally{i.endUpdate()}return t};n.addListener("cellsInserted",(function(t,e){g(e.getProperty("cells"),null,null,null,null,!0,!0)})),n.addListener("textInserted",(function(t,e){g(e.getProperty("cells"),!0)})),this.insertHandler=g,this.createDivs(),this.createUi(),this.refresh();var m=mxUtils.bind(this,(function(t){return null==t&&(t=window.event),n.isEditing()||null!=t&&this.isSelectionAllowed(t)}));if(this.container==document.body&&(this.menubarContainer.onselectstart=m,this.menubarContainer.onmousedown=m,this.toolbarContainer.onselectstart=m,this.toolbarContainer.onmousedown=m,this.diagramContainer.onselectstart=m,this.diagramContainer.onmousedown=m,this.sidebarContainer.onselectstart=m,this.sidebarContainer.onmousedown=m,this.formatContainer.onselectstart=m,this.formatContainer.onmousedown=m,this.footerContainer.onselectstart=m,this.footerContainer.onmousedown=m,null!=this.tabContainer&&(this.tabContainer.onselectstart=m)),!this.editor.chromeless||this.editor.editable){var p=function(t){if(null!=t){var e=mxEvent.getSource(t);if("A"==e.nodeName)for(;null!=e;){if("geHint"==e.className)return!0;e=e.parentNode}}return m(t)};mxClient.IS_IE&&(void 0===document.documentMode||document.documentMode<9)?mxEvent.addListener(this.diagramContainer,"contextmenu",p):this.diagramContainer.oncontextmenu=p}else n.panningHandler.usePopupTrigger=!1;if(n.init(this.diagramContainer),mxClient.IS_SVG&&null!=n.view.getDrawPane()){var f=n.view.getDrawPane().ownerSVGElement;null!=f&&(f.style.position="absolute")}if(this.hoverIcons=this.createHoverIcons(),null!=n.graphHandler){var x=n.graphHandler.start;n.graphHandler.start=function(){null!=P.hoverIcons&&P.hoverIcons.reset(),x.apply(this,arguments)}}mxEvent.addListener(this.diagramContainer,"mousemove",mxUtils.bind(this,(function(t){var e=mxUtils.getOffset(this.diagramContainer);mxEvent.getClientX(t)-e.x-this.diagramContainer.clientWidth>0||mxEvent.getClientY(t)-e.y-this.diagramContainer.clientHeight>0?this.diagramContainer.setAttribute("title",mxResources.get("panTooltip")):this.diagramContainer.removeAttribute("title")})));var v=!1,y=this.hoverIcons.isResetEvent;this.hoverIcons.isResetEvent=function(t,e){return v||y.apply(this,arguments)},this.keydownHandler=mxUtils.bind(this,(function(t){32!=t.which||n.isEditing()?mxEvent.isConsumed(t)||27!=t.keyCode||this.hideDialog(null,!0):(v=!0,this.hoverIcons.reset(),n.container.style.cursor="move",n.isEditing()||mxEvent.getSource(t)!=n.container||mxEvent.consume(t))})),mxEvent.addListener(document,"keydown",this.keydownHandler),this.keyupHandler=mxUtils.bind(this,(function(t){n.container.style.cursor="",v=!1})),mxEvent.addListener(document,"keyup",this.keyupHandler);var E=n.panningHandler.isForcePanningEvent;n.panningHandler.isForcePanningEvent=function(t){return E.apply(this,arguments)||v||mxEvent.isMouseEvent(t.getEvent())&&(this.usePopupTrigger||!mxEvent.isPopupTrigger(t.getEvent()))&&(!mxEvent.isControlDown(t.getEvent())&&mxEvent.isRightMouseButton(t.getEvent())||mxEvent.isMiddleMouseButton(t.getEvent()))};var b=n.cellEditor.isStopEditingEvent;n.cellEditor.isStopEditingEvent=function(t){return b.apply(this,arguments)||13==t.keyCode&&(!mxClient.IS_SF&&mxEvent.isControlDown(t)||mxClient.IS_MAC&&mxEvent.isMetaDown(t)||mxClient.IS_SF&&mxEvent.isShiftDown(t))};var C=n.isZoomWheelEvent;n.isZoomWheelEvent=function(){return v||C.apply(this,arguments)};var S=!1,w=null,U=null,T=null,M=mxUtils.bind(this,(function(){if(null!=this.toolbar&&S!=n.cellEditor.isContentEditing()){for(var t=this.toolbar.container.firstChild,e=[];null!=t;){var i=t.nextSibling;mxUtils.indexOf(this.toolbar.staticElements,t)<0&&(t.parentNode.removeChild(t),e.push(t)),t=i}var o=this.toolbar.fontMenu,r=this.toolbar.sizeMenu;if(null==T)this.toolbar.createTextToolbar();else{for(var l=0;l<T.length;l++)this.toolbar.container.appendChild(T[l]);this.toolbar.fontMenu=w,this.toolbar.sizeMenu=U}S=n.cellEditor.isContentEditing(),w=o,U=r,T=e}})),P=this,k=n.cellEditor.startEditing;n.cellEditor.startEditing=function(){if(k.apply(this,arguments),M(),n.cellEditor.isContentEditing()){var t=!1,e=function(){t||(t=!0,window.setTimeout((function(){var e=n.getSelectedEditingElement();if(null!=e){var i=mxUtils.getCurrentStyle(e);null!=i&&null!=P.toolbar&&(P.toolbar.setFontName(Graph.stripQuotes(i.fontFamily)),P.toolbar.setFontSize(parseInt(i.fontSize)))}t=!1}),0))};mxEvent.addListener(n.cellEditor.textarea,"input",e),mxEvent.addListener(n.cellEditor.textarea,"touchend",e),mxEvent.addListener(n.cellEditor.textarea,"mouseup",e),mxEvent.addListener(n.cellEditor.textarea,"keyup",e),e()}};var L=n.cellEditor.stopEditing;if(n.cellEditor.stopEditing=function(t,e){try{L.apply(this,arguments),M()}catch(t){P.handleError(t)}},n.container.setAttribute("tabindex","0"),n.container.style.cursor="default",window.self===window.top&&null!=n.container.parentNode)try{n.container.focus()}catch(t){}var A=n.fireMouseEvent;if(n.fireMouseEvent=function(t,e,i){t==mxEvent.MOUSE_DOWN&&this.container.focus(),A.apply(this,arguments)},n.popupMenuHandler.autoExpand=!0,null!=this.menus&&(n.popupMenuHandler.factoryMethod=mxUtils.bind(this,(function(t,e,i){this.menus.createPopupMenu(t,e,i)}))),mxEvent.addGestureListeners(document,mxUtils.bind(this,(function(t){n.popupMenuHandler.hideMenu()}))),this.keyHandler=this.createKeyHandler(t),this.getKeyHandler=function(){return keyHandler},n.connectionHandler.addListener(mxEvent.CONNECT,(function(t,e){var i=[e.getProperty("cell")];e.getProperty("terminalInserted")&&(i.push(e.getProperty("terminal")),window.setTimeout((function(){null!=P.hoverIcons&&P.hoverIcons.update(n.view.getState(i[i.length-1]))}),0)),g(i)})),this.addListener("styleChanged",mxUtils.bind(this,(function(t,e){var i=e.getProperty("cells"),o=!1,s=!1;if(i.length>0)for(var d=0;d<i.length&&(o=n.getModel().isVertex(i[d])||o,!(s=n.getModel().isEdge(i[d])||s)||!o);d++);else o=!0,s=!0;var c=e.getProperty("keys"),u=e.getProperty("values");for(d=0;d<c.length;d++){var g=mxUtils.indexOf(a,c[d])>=0;("strokeColor"!=c[d]||null!=u[d]&&"none"!=u[d])&&(mxUtils.indexOf(l,c[d])>=0?s||mxUtils.indexOf(h,c[d])>=0?null==u[d]?delete n.currentEdgeStyle[c[d]]:n.currentEdgeStyle[c[d]]=u[d]:o&&mxUtils.indexOf(r,c[d])>=0&&(null==u[d]?delete n.currentVertexStyle[c[d]]:n.currentVertexStyle[c[d]]=u[d]):mxUtils.indexOf(r,c[d])>=0&&((o||g)&&(null==u[d]?delete n.currentVertexStyle[c[d]]:n.currentVertexStyle[c[d]]=u[d]),(s||g||mxUtils.indexOf(h,c[d])>=0)&&(null==u[d]?delete n.currentEdgeStyle[c[d]]:n.currentEdgeStyle[c[d]]=u[d])))}if(null!=this.toolbar){if(this.toolbar.setFontName(n.currentVertexStyle.fontFamily||Menus.prototype.defaultFont),this.toolbar.setFontSize(n.currentVertexStyle.fontSize||Menus.prototype.defaultFontSize),null!=this.toolbar.edgeStyleMenu){var m=this.toolbar.edgeStyleMenu.getElementsByTagName("div")[0];"orthogonalEdgeStyle"==n.currentEdgeStyle.edgeStyle&&"1"==n.currentEdgeStyle.curved?m.className="geSprite geSprite-curved":"straight"==n.currentEdgeStyle.edgeStyle||"none"==n.currentEdgeStyle.edgeStyle||null==n.currentEdgeStyle.edgeStyle?m.className="geSprite geSprite-straight":"entityRelationEdgeStyle"==n.currentEdgeStyle.edgeStyle?m.className="geSprite geSprite-entity":"elbowEdgeStyle"==n.currentEdgeStyle.edgeStyle?m.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalelbow":"horizontalelbow"):"isometricEdgeStyle"==n.currentEdgeStyle.edgeStyle?m.className="geSprite geSprite-"+("vertical"==n.currentEdgeStyle.elbow?"verticalisometric":"horizontalisometric"):m.className="geSprite geSprite-orthogonal"}if(null!=this.toolbar.edgeShapeMenu){var p=this.toolbar.edgeShapeMenu.getElementsByTagName("div")[0];"link"==n.currentEdgeStyle.shape?p.className="geSprite geSprite-linkedge":"flexArrow"==n.currentEdgeStyle.shape?p.className="geSprite geSprite-arrow":"arrow"==n.currentEdgeStyle.shape?p.className="geSprite geSprite-simplearrow":p.className="geSprite geSprite-connection"}null!=this.toolbar.lineStartMenu&&(this.toolbar.lineStartMenu.getElementsByTagName("div")[0].className=this.getCssClassForMarker("start",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_STARTARROW],mxUtils.getValue(n.currentEdgeStyle,"startFill","1"))),null!=this.toolbar.lineEndMenu&&(this.toolbar.lineEndMenu.getElementsByTagName("div")[0].className=this.getCssClassForMarker("end",n.currentEdgeStyle.shape,n.currentEdgeStyle[mxConstants.STYLE_ENDARROW],mxUtils.getValue(n.currentEdgeStyle,"endFill","1")))}}))),null!=this.toolbar){var I=mxUtils.bind(this,(function(){var t=n.currentVertexStyle.fontFamily||"Helvetica",e=String(n.currentVertexStyle.fontSize||"12"),i=n.getView().getState(n.getSelectionCell());null!=i&&(t=i.style[mxConstants.STYLE_FONTFAMILY]||t,e=i.style[mxConstants.STYLE_FONTSIZE]||e,t.length>10&&(t=t.substring(0,8)+"...")),this.toolbar.setFontName(t),this.toolbar.setFontSize(e)}));n.getSelectionModel().addListener(mxEvent.CHANGE,I),n.getModel().addListener(mxEvent.CHANGE,I)}n.addListener(mxEvent.CELLS_ADDED,(function(t,e){var i=e.getProperty("cells"),o=e.getProperty("parent");null!=o&&n.getModel().isLayer(o)&&!n.isCellVisible(o)&&null!=i&&i.length>0&&n.getModel().setVisible(o,!0)})),this.gestureHandler=mxUtils.bind(this,(function(t){null!=this.currentMenu&&mxEvent.getSource(t)!=this.currentMenu.div&&this.hideCurrentMenu()})),mxEvent.addGestureListeners(document,this.gestureHandler),this.resizeHandler=mxUtils.bind(this,(function(){window.setTimeout(mxUtils.bind(this,(function(){null!=this.editor.graph&&this.refresh()})),0)})),mxEvent.addListener(window,"resize",this.resizeHandler),this.orientationChangeHandler=mxUtils.bind(this,(function(){this.refresh()})),mxEvent.addListener(window,"orientationchange",this.orientationChangeHandler),mxClient.IS_IOS&&!window.navigator.standalone&&(this.scrollHandler=mxUtils.bind(this,(function(){window.scrollTo(0,0)})),mxEvent.addListener(window,"scroll",this.scrollHandler)),this.editor.addListener("resetGraphView",mxUtils.bind(this,(function(){this.resetScrollbars()}))),this.addListener("gridEnabledChanged",mxUtils.bind(this,(function(){n.view.validateBackground()}))),this.addListener("backgroundColorChanged",mxUtils.bind(this,(function(){n.view.validateBackground()}))),n.addListener("gridSizeChanged",mxUtils.bind(this,(function(){n.isGridEnabled()&&n.view.validateBackground()}))),this.editor.resetGraph()}this.init(),n.standalone||this.open()},EditorUi.compactUi=!0,EditorUi.parsePng=function(t,e,i){var n=0;function o(t,e){var i=n;return n+=e,t.substring(i,n)}if(o(t,8)==String.fromCharCode(137)+"PNG"+String.fromCharCode(13,10,26,10))if(o(t,4),"IHDR"==o(t,4)){o(t,17);do{var r=(s=void 0,(s=o(t,4)).charCodeAt(3)+(s.charCodeAt(2)<<8)+(s.charCodeAt(1)<<16)+(s.charCodeAt(0)<<24)),l=o(t,4);if(null!=e&&e(n-8,l,r))break;if(value=o(t,r),o(t,4),"IEND"==l)break}while(r);var s}else null!=i&&i();else null!=i&&i()},mxUtils.extend(EditorUi,mxEventSource),EditorUi.prototype.splitSize=mxClient.IS_TOUCH||mxClient.IS_POINTER?12:8,EditorUi.prototype.menubarHeight=30,EditorUi.prototype.formatEnabled=!0,EditorUi.prototype.formatWidth=240,EditorUi.prototype.toolbarHeight=38,EditorUi.prototype.footerHeight=28,EditorUi.prototype.sidebarFooterHeight=34,EditorUi.prototype.hsplitPosition=screen.width<=640?118:"large"!=urlParams["sidebar-entries"]?212:240,EditorUi.prototype.allowAnimation=!0,EditorUi.prototype.lightboxMaxFitScale=2,EditorUi.prototype.lightboxVerticalDivider=4,EditorUi.prototype.hsplitClickEnabled=!1,EditorUi.prototype.init=function(){var t=this.editor.graph;if(!t.standalone){"0"!=urlParams["shape-picker"]&&this.installShapePicker(),mxEvent.addListener(t.container,"scroll",mxUtils.bind(this,(function(){t.tooltipHandler.hide(),null!=t.connectionHandler&&null!=t.connectionHandler.constraintHandler&&t.connectionHandler.constraintHandler.reset()}))),t.addListener(mxEvent.ESCAPE,mxUtils.bind(this,(function(){t.tooltipHandler.hide();var e=t.getRubberband();null!=e&&e.cancel()}))),mxEvent.addListener(t.container,"keydown",mxUtils.bind(this,(function(t){this.onKeyDown(t)}))),mxEvent.addListener(t.container,"keypress",mxUtils.bind(this,(function(t){this.onKeyPress(t)}))),this.addUndoListener(),this.addBeforeUnloadListener(),t.getSelectionModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,(function(){this.updateActionStates()}))),t.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,(function(){this.updateActionStates()})));var e=t.setDefaultParent,i=this;this.editor.graph.setDefaultParent=function(){e.apply(this,arguments),i.updateActionStates()},t.editLink=i.actions.get("editLink").funct,this.updateActionStates(),this.initClipboard(),this.initCanvas(),null!=this.format&&this.format.init()}},EditorUi.prototype.clearSelectionState=function(){this.selectionState=null},EditorUi.prototype.getSelectionState=function(){return null==this.selectionState&&(this.selectionState=this.createSelectionState()),this.selectionState},EditorUi.prototype.createSelectionState=function(){for(var t=this.editor.graph,e=t.getSelectionCells(),i=this.initSelectionState(),n=!0,o=0;o<e.length;o++){var r=t.getCurrentCellStyle(e[o]);"0"!=mxUtils.getValue(r,mxConstants.STYLE_EDITABLE,"1")&&(this.updateSelectionStateForCell(i,e[o],e,n),n=!1)}return this.updateSelectionStateForTableCells(i),i},EditorUi.prototype.initSelectionState=function(){return{vertices:[],edges:[],cells:[],x:null,y:null,width:null,height:null,style:{},containsImage:!1,containsLabel:!1,fill:!0,glass:!0,rounded:!0,autoSize:!1,image:!0,shadow:!0,lineJumps:!0,resizable:!0,table:!1,cell:!1,row:!1,movable:!0,rotatable:!0,stroke:!0,swimlane:!1,unlocked:this.editor.graph.isEnabled(),connections:!1}},EditorUi.prototype.updateSelectionStateForTableCells=function(t){},EditorUi.prototype.updateSelectionStateForCell=function(t,e,i,n){var o=this.editor.graph;if(t.cells.push(e),o.getModel().isVertex(e)){t.connections=o.model.getEdgeCount(e)>0,t.unlocked=t.unlocked&&!o.isCellLocked(e),t.resizable=t.resizable&&o.isCellResizable(e),t.rotatable=t.rotatable&&o.isCellRotatable(e),t.movable=t.movable&&o.isCellMovable(e)&&!o.isTableRow(e)&&!o.isTableCell(e),t.swimlane=t.swimlane||o.isSwimlane(e),t.table=t.table||o.isTable(e),t.cell=t.cell||o.isTableCell(e),t.row=t.row||o.isTableRow(e),t.vertices.push(e);var r=o.getCellGeometry(e);if(null!=r&&(r.width>0?null==t.width?t.width=r.width:t.width!=r.width&&(t.width=""):t.containsLabel=!0,r.height>0?null==t.height?t.height=r.height:t.height!=r.height&&(t.height=""):t.containsLabel=!0,!r.relative||null!=r.offset)){var l=r.relative?r.offset.x:r.x,s=r.relative?r.offset.y:r.y;null==t.x?t.x=l:t.x!=l&&(t.x=""),null==t.y?t.y=s:t.y!=s&&(t.y="")}}else o.getModel().isEdge(e)&&(t.edges.push(e),t.connections=!0,t.resizable=!1,t.rotatable=!1,t.movable=!1);var a=o.view.getState(e);if(null!=a){t.autoSize=t.autoSize||o.isAutoSizeState(a),t.glass=t.glass&&o.isGlassState(a),t.rounded=t.rounded&&o.isRoundedState(a),t.lineJumps=t.lineJumps&&o.isLineJumpState(a),t.image=t.image&&o.isImageState(a),t.shadow=t.shadow&&o.isShadowState(a),t.fill=t.fill&&o.isFillState(a),t.stroke=t.stroke&&o.isStrokeState(a);var d=mxUtils.getValue(a.style,mxConstants.STYLE_SHAPE,null);t.containsImage=t.containsImage||"image"==d,o.mergeStyle(a.style,t.style,n)}},EditorUi.prototype.installShapePicker=function(){var t=this.editor.graph,e=this;t.addListener(mxEvent.FIRE_MOUSE_EVENT,mxUtils.bind(this,(function(t,i){"mouseDown"==i.getProperty("eventName")&&e.hideShapePicker()})));var i=mxUtils.bind(this,(function(){e.hideShapePicker(!0)}));t.addListener("wheel",i),t.addListener(mxEvent.ESCAPE,i),t.view.addListener(mxEvent.SCALE,i),t.view.addListener(mxEvent.SCALE_AND_TRANSLATE,i),t.getSelectionModel().addListener(mxEvent.CHANGE,i),t.getModel().addListener(mxEvent.CHANGE,i);var n=t.popupMenuHandler.isMenuShowing;t.popupMenuHandler.isMenuShowing=function(){return n.apply(this,arguments)||null!=e.shapePicker};var o=t.dblClick;if(t.dblClick=function(i,n){if(this.isEnabled())if(null!=n||null==e.sidebar||mxEvent.isShiftDown(i)||t.isCellLocked(t.getDefaultParent()))o.apply(this,arguments);else{var r=mxUtils.convertPoint(this.container,mxEvent.getClientX(i),mxEvent.getClientY(i));mxEvent.consume(i),window.setTimeout(mxUtils.bind(this,(function(){e.showShapePicker(r.x,r.y)})),30)}},null!=this.hoverIcons){this.hoverIcons.addListener("reset",i);var r=this.hoverIcons.drag;this.hoverIcons.drag=function(){e.hideShapePicker(),r.apply(this,arguments)};var l=this.hoverIcons.execute;this.hoverIcons.execute=function(i,n,o){var r=o.getEvent();this.graph.isCloneEvent(r)||mxEvent.isShiftDown(r)?l.apply(this,arguments):this.graph.connectVertex(i.cell,n,this.graph.defaultEdgeLength,r,null,null,mxUtils.bind(this,(function(r,l,s){var a=t.getCompositeParent(i.cell),d=t.getCellGeometry(a);for(o.consume();null!=a&&t.model.isVertex(a)&&null!=d&&d.relative;)cell=a,a=t.model.getParent(cell),d=t.getCellGeometry(a);window.setTimeout(mxUtils.bind(this,(function(){e.showShapePicker(o.getGraphX(),o.getGraphY(),a,mxUtils.bind(this,(function(i){s(i),null!=e.hoverIcons&&e.hoverIcons.update(t.view.getState(i))})),n)})),30)})),mxUtils.bind(this,(function(t){this.graph.selectCellsForConnectVertex(t,r,this)})))};var s=null;this.hoverIcons.addListener("focus",mxUtils.bind(this,(function(i,n){null!=s&&window.clearTimeout(s),s=window.setTimeout(mxUtils.bind(this,(function(){var i=n.getProperty("arrow"),o=n.getProperty("direction"),r=n.getProperty("event"),l=i.getBoundingClientRect(),s=mxUtils.getOffset(t.container),a=t.container.scrollLeft+l.x-s.x,d=t.container.scrollTop+l.y-s.y,h=t.getCompositeParent(null!=this.hoverIcons.currentState?this.hoverIcons.currentState.cell:null),c=e.showShapePicker(a,d,h,mxUtils.bind(this,(function(i){null!=i&&t.connectVertex(h,o,t.defaultEdgeLength,r,!0,!0,(function(n,o,r){r(i),null!=e.hoverIcons&&e.hoverIcons.update(t.view.getState(i))}),(function(e){t.selectCellsForConnectVertex(e)}),r,this.hoverIcons)})),o,!0);this.centerShapePicker(c,l,a,d,o),mxUtils.setOpacity(c,30),mxEvent.addListener(c,"mouseenter",(function(){mxUtils.setOpacity(c,100)})),mxEvent.addListener(c,"mouseleave",(function(){e.hideShapePicker()}))})),Editor.shapePickerHoverDelay)}))),this.hoverIcons.addListener("blur",mxUtils.bind(this,(function(t,e){null!=s&&window.clearTimeout(s)})))}},EditorUi.prototype.centerShapePicker=function(t,e,i,n,o){o!=mxConstants.DIRECTION_EAST&&o!=mxConstants.DIRECTION_WEST||(t.style.width="40px");var r=t.getBoundingClientRect();o==mxConstants.DIRECTION_NORTH?(i-=r.width/2-10,n-=r.height+6):o==mxConstants.DIRECTION_SOUTH?(i-=r.width/2-10,n+=e.height+6):o==mxConstants.DIRECTION_WEST?(i-=r.width+6,n-=r.height/2-10):o==mxConstants.DIRECTION_EAST&&(i+=e.width+6,n-=r.height/2-10),t.style.left=i+"px",t.style.top=n+"px"},EditorUi.prototype.showShapePicker=function(t,e,i,n,o,r){var l=this.createShapePicker(t,e,i,n,o,mxUtils.bind(this,(function(){this.hideShapePicker()})),this.getCellsForShapePicker(i,r),r);if(null!=l){null==this.hoverIcons||r||this.hoverIcons.reset();var s=this.editor.graph;s.popupMenuHandler.hideMenu(),s.tooltipHandler.hideTooltip(),this.hideCurrentMenu(),this.hideShapePicker(),this.shapePickerCallback=n,this.shapePicker=l}return l},EditorUi.prototype.createShapePicker=function(t,e,i,n,o,r,l,s){var a=null;if(null!=l&&l.length>0){var d=this,h=this.editor.graph;a=document.createElement("div");var c=h.view.getState(i),u=null==i||null!=c&&h.isTransparentState(c)?null:h.copyStyle(i),g=l.length<6?35*l.length:140;a.className="geToolbarContainer geSidebarContainer",a.style.cssText="position:absolute;left:"+t+"px;top:"+e+"px;width:"+g+"px;border-radius:10px;padding:4px;text-align:center;box-shadow:0px 0px 3px 1px #d1d1d1;padding: 6px 0 8px 0;z-index: "+mxPopupMenu.prototype.zIndex+"1;",s||mxUtils.setPrefixedStyle(a.style,"transform","translate(-22px,-22px)"),null!=h.background&&h.background!=mxConstants.NONE&&(a.style.backgroundColor=h.background),h.container.appendChild(a);for(var m=mxUtils.bind(this,(function(i){var o=document.createElement("a");o.className="geItem",o.style.cssText="position:relative;display:inline-block;position:relative;width:30px;height:30px;cursor:pointer;overflow:hidden;padding:3px 0 0 3px;",a.appendChild(o),null!=u&&"1"!=urlParams.sketch?this.sidebar.graph.pasteStyle(u,[i]):d.insertHandler([i],""!=i.value&&"1"!=urlParams.sketch,this.sidebar.graph.model),this.sidebar.createThumb([i],25,25,o,null,!0,!1,i.geometry.width,i.geometry.height),mxEvent.addListener(o,"click",(function(){var o=h.cloneCell(i);if(null!=n)n(o);else{o.geometry.x=h.snap(Math.round(t/h.view.scale)-h.view.translate.x-i.geometry.width/2),o.geometry.y=h.snap(Math.round(e/h.view.scale)-h.view.translate.y-i.geometry.height/2),h.model.beginUpdate();try{h.addCell(o)}finally{h.model.endUpdate()}h.setSelectionCell(o),h.scrollCellToVisible(o),h.startEditingAtCell(o),null!=d.hoverIcons&&d.hoverIcons.update(h.view.getState(o))}null!=r&&r()}))})),p=0;p<(s?Math.min(l.length,4):l.length);p++)m(l[p]);var f=h.container.scrollTop+h.container.offsetHeight,x=a.offsetTop+a.clientHeight-f;x>0&&(a.style.top=Math.max(h.container.scrollTop+22,e-x)+"px");var v=h.container.scrollLeft+h.container.offsetWidth,y=a.offsetLeft+a.clientWidth-v;y>0&&(a.style.left=Math.max(h.container.scrollLeft+22,t-y)+"px")}return a},EditorUi.prototype.getCellsForShapePicker=function(t,e){var i=mxUtils.bind(this,(function(t,e,i,n){return this.editor.graph.createVertex(null,null,n||"",0,0,e||120,i||60,t,!1)}));return[null!=t?this.editor.graph.cloneCell(t):i("text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;",40,20,"Text"),i("whiteSpace=wrap;html=1;"),i("ellipse;whiteSpace=wrap;html=1;"),i("rhombus;whiteSpace=wrap;html=1;",80,80),i("rounded=1;whiteSpace=wrap;html=1;"),i("shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;"),i("shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;",120,60),i("shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;",120,80),i("shape=step;perimeter=stepPerimeter;whiteSpace=wrap;html=1;fixedSize=1;",120,80),i("shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;"),i("triangle;whiteSpace=wrap;html=1;",60,80),i("shape=document;whiteSpace=wrap;html=1;boundedLbl=1;",120,80),i("shape=tape;whiteSpace=wrap;html=1;",120,100),i("ellipse;shape=cloud;whiteSpace=wrap;html=1;",120,80),i("shape=singleArrow;whiteSpace=wrap;html=1;arrowWidth=0.4;arrowSize=0.4;",80,60),i("shape=waypoint;sketch=0;size=6;pointerEvents=1;points=[];fillColor=none;resizable=0;rotatable=0;perimeter=centerPerimeter;snapToPoint=1;",40,40)]},EditorUi.prototype.hideShapePicker=function(t){null!=this.shapePicker&&(this.shapePicker.parentNode.removeChild(this.shapePicker),this.shapePicker=null,t||null==this.shapePickerCallback||this.shapePickerCallback(),this.shapePickerCallback=null)},EditorUi.prototype.onKeyDown=function(t){var e=this.editor.graph;if(9==t.which&&e.isEnabled()&&!mxEvent.isControlDown(t)){if(e.isEditing())if(mxEvent.isAltDown(t))e.stopEditing(!1);else try{e.cellEditor.isContentEditing()&&e.cellEditor.isTextSelected()?document.execCommand(mxEvent.isShiftDown(t)?"outdent":"indent",!1,null):mxEvent.isShiftDown(t)?e.stopEditing(!1):e.cellEditor.insertTab(e.cellEditor.isContentEditing()?null:4)}catch(t){}else mxEvent.isAltDown(t)?e.selectParentCell():e.selectCell(!mxEvent.isShiftDown(t));mxEvent.consume(t)}},EditorUi.prototype.onKeyPress=function(t){var e=this.editor.graph;if(this.isImmediateEditingEvent(t)&&!e.isEditing()&&!e.isSelectionEmpty()&&0!==t.which&&27!==t.which&&!mxEvent.isAltDown(t)&&!mxEvent.isControlDown(t)&&!mxEvent.isMetaDown(t)&&(e.escape(),e.startEditing(),mxClient.IS_FF)){var i=e.cellEditor;if(null!=i.textarea){i.textarea.innerHTML=String.fromCharCode(t.which);var n=document.createRange();n.selectNodeContents(i.textarea),n.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(n)}}},EditorUi.prototype.isImmediateEditingEvent=function(t){return!0},EditorUi.prototype.getCssClassForMarker=function(t,e,i,n){return"flexArrow"==e?null!=i&&i!=mxConstants.NONE?"geSprite geSprite-"+t+"blocktrans":"geSprite geSprite-noarrow":"box"==i||"halfCircle"==i?"geSprite geSvgSprite geSprite-"+i+("end"==t?" geFlipSprite":""):i==mxConstants.ARROW_CLASSIC?"1"==n?"geSprite geSprite-"+t+"classic":"geSprite geSprite-"+t+"classictrans":i==mxConstants.ARROW_CLASSIC_THIN?"1"==n?"geSprite geSprite-"+t+"classicthin":"geSprite geSprite-"+t+"classicthintrans":i==mxConstants.ARROW_OPEN?"geSprite geSprite-"+t+"open":i==mxConstants.ARROW_OPEN_THIN?"geSprite geSprite-"+t+"openthin":i==mxConstants.ARROW_BLOCK?"1"==n?"geSprite geSprite-"+t+"block":"geSprite geSprite-"+t+"blocktrans":i==mxConstants.ARROW_BLOCK_THIN?"1"==n?"geSprite geSprite-"+t+"blockthin":"geSprite geSprite-"+t+"blockthintrans":i==mxConstants.ARROW_OVAL?"1"==n?"geSprite geSprite-"+t+"oval":"geSprite geSprite-"+t+"ovaltrans":i==mxConstants.ARROW_DIAMOND?"1"==n?"geSprite geSprite-"+t+"diamond":"geSprite geSprite-"+t+"diamondtrans":i==mxConstants.ARROW_DIAMOND_THIN?"1"==n?"geSprite geSprite-"+t+"thindiamond":"geSprite geSprite-"+t+"thindiamondtrans":"openAsync"==i?"geSprite geSprite-"+t+"openasync":"dash"==i?"geSprite geSprite-"+t+"dash":"cross"==i?"geSprite geSprite-"+t+"cross":"async"==i?"1"==n?"geSprite geSprite-"+t+"async":"geSprite geSprite-"+t+"asynctrans":"circle"==i||"circlePlus"==i?"1"==n||"circle"==i?"geSprite geSprite-"+t+"circle":"geSprite geSprite-"+t+"circleplus":"ERone"==i?"geSprite geSprite-"+t+"erone":"ERmandOne"==i?"geSprite geSprite-"+t+"eronetoone":"ERmany"==i?"geSprite geSprite-"+t+"ermany":"ERoneToMany"==i?"geSprite geSprite-"+t+"eronetomany":"ERzeroToOne"==i?"geSprite geSprite-"+t+"eroneopt":"ERzeroToMany"==i?"geSprite geSprite-"+t+"ermanyopt":"geSprite geSprite-noarrow"},EditorUi.prototype.createMenus=function(){return null},EditorUi.prototype.updatePasteActionStates=function(){var t=this.editor.graph,e=this.actions.get("paste"),i=this.actions.get("pasteHere");e.setEnabled(this.editor.graph.cellEditor.isContentEditing()||(!mxClient.IS_FF&&null!=navigator.clipboard||!mxClipboard.isEmpty())&&t.isEnabled()&&!t.isCellLocked(t.getDefaultParent())),i.setEnabled(e.isEnabled())},EditorUi.prototype.initClipboard=function(){var t=this,e=mxClipboard.cut;mxClipboard.cut=function(i){i.cellEditor.isContentEditing()?document.execCommand("cut",!1,null):e.apply(this,arguments),t.updatePasteActionStates()},mxClipboard.copy,mxClipboard.copy=function(e){var i=null;if(e.cellEditor.isContentEditing())document.execCommand("copy",!1,null);else{i=i||e.getSelectionCells(),i=e.getExportableCells(e.model.getTopmostCells(i));for(var n=new Object,o=e.createCellLookup(i),r=e.cloneCells(i,null,n),l=new mxGraphModel,s=l.getChildAt(l.getRoot(),0),a=0;a<r.length;a++){l.add(s,r[a]);var d=e.view.getState(i[a]);if(null!=d){var h=e.getCellGeometry(r[a]);null!=h&&h.relative&&!l.isEdge(i[a])&&null==o[mxObjectIdentity.get(l.getParent(i[a]))]&&(h.offset=null,h.relative=!1,h.x=d.x/d.view.scale-d.view.translate.x,h.y=d.y/d.view.scale-d.view.translate.y)}}e.updateCustomLinks(e.createCellMapping(n,o),r),mxClipboard.insertCount=1,mxClipboard.setCells(r)}return t.updatePasteActionStates(),i};var i=mxClipboard.paste;mxClipboard.paste=function(e){var n=null;return e.cellEditor.isContentEditing()?document.execCommand("paste",!1,null):n=i.apply(this,arguments),t.updatePasteActionStates(),n};var n=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){n.apply(this,arguments),t.updatePasteActionStates()};var o=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(e,i){o.apply(this,arguments),t.updatePasteActionStates()},this.updatePasteActionStates()},EditorUi.prototype.lazyZoomDelay=20,EditorUi.prototype.wheelZoomDelay=400,EditorUi.prototype.buttonZoomDelay=600,EditorUi.prototype.initCanvas=function(){var t=this.editor.graph;t.timerAutoScroll=!0,t.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round((t.container.offsetWidth-34)/t.view.scale)),Math.max(0,Math.round((t.container.offsetHeight-34)/t.view.scale)))},t.view.getBackgroundPageBounds=function(){var t=this.graph.getPageLayout(),e=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+t.x*e.width),this.scale*(this.translate.y+t.y*e.height),this.scale*t.width*e.width,this.scale*t.height*e.height)},t.getPreferredPageSize=function(t,e,i){var n=this.getPageLayout(),o=this.getPageSize();return new mxRectangle(0,0,n.width*o.width,n.height*o.height)};var e=null,i=this;if(this.editor.isChromelessView()){e=mxUtils.bind(this,(function(e,i,n,o){if(null!=t.container&&!t.isViewer()){n=null!=n?n:0,o=null!=o?o:0;var r=t.pageVisible?t.view.getBackgroundPageBounds():t.getGraphBounds(),l=mxUtils.hasScrollbars(t.container),s=t.view.translate,a=t.view.scale,d=mxRectangle.fromRectangle(r);d.x=d.x/a-s.x,d.y=d.y/a-s.y,d.width/=a,d.height/=a;var h=t.container.scrollTop,c=t.container.scrollLeft,u=document.documentMode>=8?20:14;8!=document.documentMode&&9!=document.documentMode||(u+=3);var g=t.container.offsetWidth-u,m=t.container.offsetHeight-u,p=e?Math.max(.3,Math.min(i||1,g/d.width)):a,f=(g-p*d.width)/2/p,x=0==this.lightboxVerticalDivider?0:(m-p*d.height)/this.lightboxVerticalDivider/p;if(l&&(f=Math.max(f,0),x=Math.max(x,0)),l||r.width<g||r.height<m)t.view.scaleAndTranslate(p,Math.floor(f-d.x),Math.floor(x-d.y)),t.container.scrollTop=h*p/a,t.container.scrollLeft=c*p/a;else if(0!=n||0!=o){var v=t.view.translate;t.view.setTranslate(Math.floor(v.x+n/a),Math.floor(v.y+o/a))}}})),this.chromelessResize=e,this.chromelessWindowResize=mxUtils.bind(this,(function(){this.chromelessResize(!1)}));var n=mxUtils.bind(this,(function(){this.chromelessWindowResize(!1)}));if(mxEvent.addListener(window,"resize",n),this.destroyFunctions.push((function(){mxEvent.removeListener(window,"resize",n)})),this.editor.addListener("resetGraphView",mxUtils.bind(this,(function(){this.chromelessResize(!0)}))),this.actions.get("zoomIn").funct=mxUtils.bind(this,(function(e){t.zoomIn(),this.chromelessResize(!1)})),this.actions.get("zoomOut").funct=mxUtils.bind(this,(function(e){t.zoomOut(),this.chromelessResize(!1)})),"0"!=urlParams.toolbar){var o=JSON.parse(decodeURIComponent(urlParams["toolbar-config"]||"{}"));this.chromelessToolbar=document.createElement("div"),this.chromelessToolbar.style.position="fixed",this.chromelessToolbar.style.overflow="hidden",this.chromelessToolbar.style.boxSizing="border-box",this.chromelessToolbar.style.whiteSpace="nowrap",this.chromelessToolbar.style.padding="10px 10px 8px 10px",this.chromelessToolbar.style.left=t.isViewer()?"0":"50%",mxClient.IS_IE||mxClient.IS_IE11?(this.chromelessToolbar.style.backgroundColor="#ffffff",this.chromelessToolbar.style.border="3px solid black"):this.chromelessToolbar.style.backgroundColor="#000000",mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"borderRadius","16px"),mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transition","opacity 600ms ease-in-out");var r=mxUtils.bind(this,(function(){var e=mxUtils.getCurrentStyle(t.container);t.isViewer()?this.chromelessToolbar.style.top="0":this.chromelessToolbar.style.bottom=(null!=e?parseInt(e["margin-bottom"]||0):0)+(null!=this.tabContainer?20+parseInt(this.tabContainer.style.height):20)+"px"}));this.editor.addListener("resetGraphView",r),r();var l=mxUtils.bind(this,(function(t,e,i){var n=document.createElement("span");n.style.paddingLeft="8px",n.style.paddingRight="8px",n.style.cursor="pointer",mxEvent.addListener(n,"click",t),null!=i&&n.setAttribute("title",i);var o=document.createElement("img");return o.setAttribute("border","0"),o.setAttribute("src",e),o.style.width="36px",o.style.filter="invert(100%)",n.appendChild(o),this.chromelessToolbar.appendChild(n),n}));if(null!=o.backBtn&&l(mxUtils.bind(this,(function(t){window.location.href=o.backBtn.url,mxEvent.consume(t)})),Editor.backImage,mxResources.get("back",null,"Back")),this.isPagesEnabled()){var s=l(mxUtils.bind(this,(function(t){this.actions.get("previousPage").funct(),mxEvent.consume(t)})),Editor.previousImage,mxResources.get("previousPage")),a=document.createElement("div");a.style.fontFamily=Editor.defaultHtmlFont,a.style.display="inline-block",a.style.verticalAlign="top",a.style.fontWeight="bold",a.style.marginTop="8px",a.style.fontSize="14px",mxClient.IS_IE||mxClient.IS_IE11?a.style.color="#000000":a.style.color="#ffffff",this.chromelessToolbar.appendChild(a);var d=l(mxUtils.bind(this,(function(t){this.actions.get("nextPage").funct(),mxEvent.consume(t)})),Editor.nextImage,mxResources.get("nextPage")),h=mxUtils.bind(this,(function(){null!=this.pages&&this.pages.length>1&&null!=this.currentPage&&(a.innerHTML="",mxUtils.write(a,mxUtils.indexOf(this.pages,this.currentPage)+1+" / "+this.pages.length))}));s.style.paddingLeft="0px",s.style.paddingRight="4px",d.style.paddingLeft="4px",d.style.paddingRight="0px";var c=mxUtils.bind(this,(function(){null!=this.pages&&this.pages.length>1&&null!=this.currentPage?(d.style.display="",s.style.display="",a.style.display="inline-block"):(d.style.display="none",s.style.display="none",a.style.display="none"),h()}));this.editor.addListener("resetGraphView",c),this.editor.addListener("pageSelected",h)}l(mxUtils.bind(this,(function(t){this.actions.get("zoomOut").funct(),mxEvent.consume(t)})),Editor.zoomOutImage,mxResources.get("zoomOut")+" (Alt+Mousewheel)"),l(mxUtils.bind(this,(function(t){this.actions.get("zoomIn").funct(),mxEvent.consume(t)})),Editor.zoomInImage,mxResources.get("zoomIn")+" (Alt+Mousewheel)"),l(mxUtils.bind(this,(function(e){t.isLightboxView()?(1==t.view.scale?this.lightboxFit():t.zoomTo(1),this.chromelessResize(!1)):this.chromelessResize(!0),mxEvent.consume(e)})),Editor.zoomFitImage,mxResources.get("fit"));var u=null,g=null,m=mxUtils.bind(this,(function(t){null!=u&&(window.clearTimeout(u),u=null),null!=g&&(window.clearTimeout(g),g=null),u=window.setTimeout(mxUtils.bind(this,(function(){mxUtils.setOpacity(this.chromelessToolbar,0),u=null,g=window.setTimeout(mxUtils.bind(this,(function(){this.chromelessToolbar.style.display="none",g=null})),600)})),t||200)})),p=mxUtils.bind(this,(function(t){null!=u&&(window.clearTimeout(u),u=null),null!=g&&(window.clearTimeout(g),g=null),this.chromelessToolbar.style.display="",mxUtils.setOpacity(this.chromelessToolbar,t||30)}));if("1"==urlParams.layers){this.layersDialog=null;var f=l(mxUtils.bind(this,(function(e){if(null!=this.layersDialog)this.layersDialog.parentNode.removeChild(this.layersDialog),this.layersDialog=null;else{this.layersDialog=t.createLayersDialog(null,!0),mxEvent.addListener(this.layersDialog,"mouseleave",mxUtils.bind(this,(function(){this.layersDialog.parentNode.removeChild(this.layersDialog),this.layersDialog=null})));var i=f.getBoundingClientRect();mxUtils.setPrefixedStyle(this.layersDialog.style,"borderRadius","5px"),this.layersDialog.style.position="fixed",this.layersDialog.style.fontFamily=Editor.defaultHtmlFont,this.layersDialog.style.width="160px",this.layersDialog.style.padding="4px 2px 4px 2px",this.layersDialog.style.left=i.left+"px",this.layersDialog.style.bottom=parseInt(this.chromelessToolbar.style.bottom)+this.chromelessToolbar.offsetHeight+4+"px",mxClient.IS_IE||mxClient.IS_IE11?(this.layersDialog.style.backgroundColor="#ffffff",this.layersDialog.style.border="2px solid black",this.layersDialog.style.color="#000000"):(this.layersDialog.style.backgroundColor="#000000",this.layersDialog.style.color="#ffffff",mxUtils.setOpacity(this.layersDialog,80));var n=mxUtils.getCurrentStyle(this.editor.graph.container);this.layersDialog.style.zIndex=n.zIndex,this.container.appendChild(this.layersDialog)||document.body.appendChild(this.layersDialog),this.editor.fireEvent(new mxEventObject("layersDialogShown"))}mxEvent.consume(e)})),Editor.layersImage,mxResources.get("layers")),x=t.getModel();x.addListener(mxEvent.CHANGE,(function(){f.style.display=x.getChildCount(x.root)>1?"":"none"}))}if(("1"!=urlParams.openInSameWin||navigator.standalone)&&this.addChromelessToolbarItems(l),null==this.editor.editButtonLink&&null==this.editor.editButtonFunc||l(mxUtils.bind(this,(function(e){null!=this.editor.editButtonFunc?this.editor.editButtonFunc():"_blank"==this.editor.editButtonLink?this.editor.editAsNew(this.getEditBlankXml()):t.openLink(this.editor.editButtonLink,"editWindow"),mxEvent.consume(e)})),Editor.editImage,mxResources.get("edit")),null!=this.lightboxToolbarActions)for(var v=0;v<this.lightboxToolbarActions.length;v++){var y=this.lightboxToolbarActions[v];y.elem=l(y.fn,y.icon,y.tooltip)}null!=o.refreshBtn&&l(mxUtils.bind(this,(function(t){o.refreshBtn.url?window.location.href=o.refreshBtn.url:window.location.reload(),mxEvent.consume(t)})),Editor.refreshImage,mxResources.get("refresh",null,"Refresh")),null!=o.fullscreenBtn&&(window.self,window.top),(o.closeBtn&&window.self===window.top||t.lightbox&&("1"==urlParams.close||this.container!=document.body))&&l(mxUtils.bind(this,(function(t){"1"==urlParams.close||o.closeBtn?window.close():(this.destroy(),mxEvent.consume(t))})),Editor.closeImage,mxResources.get("close")+" (Escape)"),this.chromelessToolbar.style.display="none",t.isViewer()||mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transform","translate(-50%,0)"),t.container.appendChild(this.chromelessToolbar),mxEvent.addListener(t.container,mxClient.IS_POINTER?"pointermove":"mousemove",mxUtils.bind(this,(function(t){mxEvent.isTouchEvent(t)||(mxEvent.isShiftDown(t)||p(30),m())}))),mxEvent.addListener(this.chromelessToolbar,mxClient.IS_POINTER?"pointermove":"mousemove",(function(t){mxEvent.consume(t)})),mxEvent.addListener(this.chromelessToolbar,"mouseenter",mxUtils.bind(this,(function(e){t.tooltipHandler.resetTimer(),t.tooltipHandler.hideTooltip(),mxEvent.isShiftDown(e)?m():p(100)}))),mxEvent.addListener(this.chromelessToolbar,"mousemove",mxUtils.bind(this,(function(t){mxEvent.isShiftDown(t)?m():p(100),mxEvent.consume(t)}))),mxEvent.addListener(this.chromelessToolbar,"mouseleave",mxUtils.bind(this,(function(t){mxEvent.isTouchEvent(t)||p(30)})));var E=t.getTolerance();t.addMouseListener({startX:0,startY:0,scrollLeft:0,scrollTop:0,mouseDown:function(e,i){this.startX=i.getGraphX(),this.startY=i.getGraphY(),this.scrollLeft=t.container.scrollLeft,this.scrollTop=t.container.scrollTop},mouseMove:function(t,e){},mouseUp:function(e,n){mxEvent.isTouchEvent(n.getEvent())&&Math.abs(this.scrollLeft-t.container.scrollLeft)<E&&Math.abs(this.scrollTop-t.container.scrollTop)<E&&Math.abs(this.startX-n.getGraphX())<E&&Math.abs(this.startY-n.getGraphY())<E&&(parseFloat(i.chromelessToolbar.style.opacity||0)>0?m():p(30))}})}this.editor.editable||this.addChromelessClickHandler()}else if(this.editor.extendCanvas){var b=t.view.validate;if(t.view.validate=function(){if(null!=this.graph.container&&mxUtils.hasScrollbars(this.graph.container)){var t=this.graph.getPagePadding(),e=this.graph.getPageSize();this.translate.x,this.translate.y,this.translate.x=t.x-(this.x0||0)*e.width,this.translate.y=t.y-(this.y0||0)*e.height}b.apply(this,arguments)},!t.isViewer()){var C=t.sizeDidChange;t.sizeDidChange=function(){if(null!=this.container&&mxUtils.hasScrollbars(this.container)){var e=this.getPageLayout(),i=this.getPagePadding(),n=this.getPageSize(),o=Math.ceil(2*i.x+e.width*n.width),r=Math.ceil(2*i.y+e.height*n.height),l=t.minimumGraphSize;null!=l&&l.width==o&&l.height==r||(t.minimumGraphSize=new mxRectangle(0,0,o,r));var s=i.x-e.x*n.width,a=i.y-e.y*n.height;if(!this.autoTranslate&&(this.view.translate.x!=s||this.view.translate.y!=a)){this.autoTranslate=!0,this.view.x0=e.x,this.view.y0=e.y;var d=t.view.translate.x,h=t.view.translate.y;return t.view.setTranslate(s,a),t.container.scrollLeft+=Math.round((s-d)*t.view.scale),t.container.scrollTop+=Math.round((a-h)*t.view.scale),void(this.autoTranslate=!1)}C.apply(this,arguments)}else this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",this.getGraphBounds()))}}}var S=t.view.getBackgroundPane(),w=t.view.getDrawPane();t.cumulativeZoomFactor=1;var U=null,T=null,M=null,P=null,k=null,L=function(n){null!=U&&window.clearTimeout(U),window.setTimeout((function(){t.isMouseDown&&!P||(U=window.setTimeout(mxUtils.bind(this,(function(){t.isFastZoomEnabled()&&(null!=t.view.backgroundPageShape&&null!=t.view.backgroundPageShape.node&&(mxUtils.setPrefixedStyle(t.view.backgroundPageShape.node.style,"transform-origin",null),mxUtils.setPrefixedStyle(t.view.backgroundPageShape.node.style,"transform",null)),w.style.transformOrigin="",S.style.transformOrigin="",mxClient.IS_SF?(w.style.transform="scale(1)",S.style.transform="scale(1)",window.setTimeout((function(){w.style.transform="",S.style.transform=""}),0)):(w.style.transform="",S.style.transform=""),t.view.getDecoratorPane().style.opacity="",t.view.getOverlayPane().style.opacity="");var n=new mxPoint(t.container.scrollLeft,t.container.scrollTop),o=mxUtils.getOffset(t.container),r=t.view.scale,l=0,s=0;null!=T&&(l=t.container.offsetWidth/2-T.x+o.x,s=t.container.offsetHeight/2-T.y+o.y),t.zoom(t.cumulativeZoomFactor,null,20),t.view.scale!=r&&(null!=M&&(l+=n.x-M.x,s+=n.y-M.y),null!=e&&i.chromelessResize(!1,null,l*(t.cumulativeZoomFactor-1),s*(t.cumulativeZoomFactor-1)),!mxUtils.hasScrollbars(t.container)||0==l&&0==s||(t.container.scrollLeft-=l*(t.cumulativeZoomFactor-1),t.container.scrollTop-=s*(t.cumulativeZoomFactor-1))),null!=k&&w.setAttribute("filter",k),t.cumulativeZoomFactor=1,U=null,M=null,T=null,P=null,k=null})),null!=n?n:t.isFastZoomEnabled()?i.wheelZoomDelay:i.lazyZoomDelay))}),0)};t.lazyZoom=function(e,n,o,r){if(r=null!=r?r:this.zoomFactor,(n=n||!t.scrollbars)&&(T=new mxPoint(t.container.offsetLeft+t.container.clientWidth/2,t.container.offsetTop+t.container.clientHeight/2)),e?this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor*=(this.view.scale+.05)/this.view.scale:(this.cumulativeZoomFactor*=r,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*100)/100/this.view.scale):this.view.scale*this.cumulativeZoomFactor<=.15?this.cumulativeZoomFactor*=(this.view.scale-.05)/this.view.scale:(this.cumulativeZoomFactor/=r,this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*100)/100/this.view.scale),this.cumulativeZoomFactor=Math.max(.05,Math.min(this.view.scale*this.cumulativeZoomFactor,160))/this.view.scale,t.isFastZoomEnabled()){null==k&&""!=w.getAttribute("filter")&&(k=w.getAttribute("filter"),w.removeAttribute("filter")),M=new mxPoint(t.container.scrollLeft,t.container.scrollTop);var l=n||null==T?t.container.scrollLeft+t.container.clientWidth/2:T.x+t.container.scrollLeft-t.container.offsetLeft,s=n||null==T?t.container.scrollTop+t.container.clientHeight/2:T.y+t.container.scrollTop-t.container.offsetTop;if(w.style.transformOrigin=l+"px "+s+"px",w.style.transform="scale("+this.cumulativeZoomFactor+")",S.style.transformOrigin=l+"px "+s+"px",S.style.transform="scale("+this.cumulativeZoomFactor+")",null!=t.view.backgroundPageShape&&null!=t.view.backgroundPageShape.node){var a=t.view.backgroundPageShape.node;mxUtils.setPrefixedStyle(a.style,"transform-origin",(n||null==T?t.container.clientWidth/2+t.container.scrollLeft-a.offsetLeft+"px":T.x+t.container.scrollLeft-a.offsetLeft-t.container.offsetLeft+"px")+" "+(n||null==T?t.container.clientHeight/2+t.container.scrollTop-a.offsetTop+"px":T.y+t.container.scrollTop-a.offsetTop-t.container.offsetTop+"px")),mxUtils.setPrefixedStyle(a.style,"transform","scale("+this.cumulativeZoomFactor+")")}t.view.getDecoratorPane().style.opacity="0",t.view.getOverlayPane().style.opacity="0",null!=i.hoverIcons&&i.hoverIcons.reset()}L(o)},mxEvent.addGestureListeners(t.container,(function(t){null!=U&&window.clearTimeout(U)}),null,(function(e){1!=t.cumulativeZoomFactor&&L(0)})),mxEvent.addListener(t.container,"scroll",(function(e){null==U||t.isMouseDown||1==t.cumulativeZoomFactor||L(0)})),mxEvent.addMouseWheelListener(mxUtils.bind(this,(function(e,i,n,o,r){if(t.fireEvent(new mxEventObject("wheel")),null==this.dialogs||0==this.dialogs.length)if(t.scrollbars||n||!t.isScrollWheelEvent(e)){if(n||t.isZoomWheelEvent(e))for(var l=mxEvent.getSource(e);null!=l;){if(l==t.container){t.tooltipHandler.hideTooltip(),T=null!=o&&null!=r?new mxPoint(o,r):new mxPoint(mxEvent.getClientX(e),mxEvent.getClientY(e)),P=n;var s=t.zoomFactor;return null!=e.deltaY&&Math.round(e.deltaY)!=e.deltaY&&(s=1+Math.abs(e.deltaY)/20*(s-1)),t.lazyZoom(i,null,null,s),mxEvent.consume(e),!1}l=l.parentNode}}else{var a=t.view.getTranslate(),d=40/t.view.scale;mxEvent.isShiftDown(e)?t.view.setTranslate(a.x+(i?-d:d),a.y):t.view.setTranslate(a.x,a.y+(i?d:-d))}})),t.container),t.panningHandler.zoomGraph=function(e){t.cumulativeZoomFactor=e.scale,t.lazyZoom(e.scale>0,!0),mxEvent.consume(e)}},EditorUi.prototype.addChromelessToolbarItems=function(t){t(mxUtils.bind(this,(function(t){this.actions.get("print").funct(),mxEvent.consume(t)})),Editor.printImage,mxResources.get("print"))},EditorUi.prototype.isPagesEnabled=function(){return this.editor.editable||"1"!=urlParams["hide-pages"]},EditorUi.prototype.createTemporaryGraph=function(t){return Graph.createOffscreenGraph(t)},EditorUi.prototype.addChromelessClickHandler=function(){var t=urlParams.highlight;null!=t&&t.length>0&&(t="#"+t),this.editor.graph.addClickHandler(t)},EditorUi.prototype.toggleFormatPanel=function(t){t=null!=t?t:0==this.formatWidth,null!=this.format&&(this.formatWidth=t?240:0,this.formatContainer.style.display=t?"":"none",this.refresh(),this.format.refresh(),this.fireEvent(new mxEventObject("formatWidthChanged")))},EditorUi.prototype.lightboxFit=function(t){if(this.isDiagramEmpty())this.editor.graph.view.setScale(1);else{var e=urlParams.border,i=60;null!=e&&(i=parseInt(e)),this.editor.graph.maxFitScale=this.lightboxMaxFitScale,this.editor.graph.fit(i,null,null,null,null,null,t),this.editor.graph.maxFitScale=null}},EditorUi.prototype.isDiagramEmpty=function(){var t=this.editor.graph.getModel();return 1==t.getChildCount(t.root)&&0==t.getChildCount(t.getChildAt(t.root,0))},EditorUi.prototype.isSelectionAllowed=function(t){return"SELECT"==mxEvent.getSource(t).nodeName||"INPUT"==mxEvent.getSource(t).nodeName&&mxUtils.isAncestorNode(this.formatContainer,mxEvent.getSource(t))},EditorUi.prototype.addBeforeUnloadListener=function(){window.onbeforeunload=mxUtils.bind(this,(function(){if(!this.editor.isChromelessView())return this.onBeforeUnload()}))},EditorUi.prototype.onBeforeUnload=function(){if(this.editor.modified)return mxResources.get("allChangesLost")},EditorUi.prototype.open=function(){try{null!=window.opener&&null!=window.opener.openFile&&window.opener.openFile.setConsumer(mxUtils.bind(this,(function(t,e){try{var i=mxUtils.parseXml(t);return this.editor.setGraphXml(i.documentElement),this.editor.setModified(!1),this.editor.undoManager.clear(),void(null!=e&&(this.editor.setFilename(e),this.updateDocumentTitle()))}catch(t){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+t.message)}})))}catch(t){}this.editor.graph.view.validate(),this.editor.graph.sizeDidChange(),this.editor.fireEvent(new mxEventObject("resetGraphView"))},EditorUi.prototype.showPopupMenu=function(t,e,i,n){this.editor.graph.popupMenuHandler.hideMenu();var o=new mxPopupMenu(t);o.div.className+=" geMenubarMenu",o.smartSeparators=!0,o.showDisabled=!0,o.autoExpand=!0,o.hideMenu=mxUtils.bind(this,(function(){mxPopupMenu.prototype.hideMenu.apply(o,arguments),o.destroy()})),o.popup(e,i,null,n),this.setCurrentMenu(o)},EditorUi.prototype.setCurrentMenu=function(t,e){this.currentMenuElt=e,this.currentMenu=t},EditorUi.prototype.resetCurrentMenu=function(){this.currentMenuElt=null,this.currentMenu=null},EditorUi.prototype.hideCurrentMenu=function(){null!=this.currentMenu&&(this.currentMenu.hideMenu(),this.resetCurrentMenu())},EditorUi.prototype.updateDocumentTitle=function(){this.editor.getOrCreateFilename(),null!=this.editor.appName&&this.editor.appName},EditorUi.prototype.createHoverIcons=function(){return new HoverIcons(this.editor.graph)},EditorUi.prototype.redo=function(){try{this.editor.graph.isEditing()?document.execCommand("redo",!1,null):this.editor.undoManager.redo()}catch(t){}},EditorUi.prototype.undo=function(){try{var t=this.editor.graph;if(t.isEditing()){var e=t.cellEditor.textarea.innerHTML;document.execCommand("undo",!1,null),e==t.cellEditor.textarea.innerHTML&&(t.stopEditing(!0),this.editor.undoManager.undo())}else this.editor.undoManager.undo()}catch(t){}},EditorUi.prototype.canRedo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canRedo()},EditorUi.prototype.canUndo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canUndo()},EditorUi.prototype.getEditBlankXml=function(){return mxUtils.getXml(this.editor.getGraphXml())},EditorUi.prototype.getUrl=function(t){var e=null!=t?t:window.location.pathname,i=e.indexOf("?")>0?1:0;for(var n in urlParams)e+=0==i?"?":"&",e+=n+"="+urlParams[n],i++;return e},EditorUi.prototype.setScrollbars=function(t){var e=this.editor.graph,i=e.container.style.overflow;e.scrollbars=t,this.editor.updateGraphComponents(),i!=e.container.style.overflow&&(e.container.scrollTop=0,e.container.scrollLeft=0,e.view.scaleAndTranslate(1,0,0),this.resetScrollbars()),this.fireEvent(new mxEventObject("scrollbarsChanged"))},EditorUi.prototype.hasScrollbars=function(){return this.editor.graph.scrollbars},EditorUi.prototype.resetScrollbars=function(){var t=this.editor.graph;if(this.editor.extendCanvas){if(!this.editor.isChromelessView())if(mxUtils.hasScrollbars(t.container))if(t.pageVisible){var e=t.getPagePadding();t.container.scrollTop=Math.floor(e.y-this.editor.initialTopSpacing)-1,t.container.scrollLeft=Math.floor(Math.min(e.x,(t.container.scrollWidth-t.container.clientWidth)/2))-1,(i=t.getGraphBounds()).width>0&&i.height>0&&(i.x>t.container.scrollLeft+.9*t.container.clientWidth&&(t.container.scrollLeft=Math.min(i.x+i.width-t.container.clientWidth,i.x-10)),i.y>t.container.scrollTop+.9*t.container.clientHeight&&(t.container.scrollTop=Math.min(i.y+i.height-t.container.clientHeight,i.y-10)))}else{var i=t.getGraphBounds(),n=Math.max(i.width,t.scrollTileSize.width*t.view.scale),o=Math.max(i.height,t.scrollTileSize.height*t.view.scale);t.container.scrollTop=Math.floor(Math.max(0,i.y-Math.max(20,(t.container.clientHeight-o)/4))),t.container.scrollLeft=Math.floor(Math.max(0,i.x-Math.max(0,(t.container.clientWidth-n)/2)))}else{var r=mxRectangle.fromRectangle(t.pageVisible?t.view.getBackgroundPageBounds():t.getGraphBounds()),l=t.view.translate,s=t.view.scale;r.x=r.x/s-l.x,r.y=r.y/s-l.y,r.width/=s,r.height/=s;var a=t.pageVisible?0:Math.max(0,(t.container.clientHeight-r.height)/4);t.view.setTranslate(Math.floor(Math.max(0,(t.container.clientWidth-r.width)/2)-r.x+2),Math.floor(a-r.y+1))}}else t.container.scrollTop=0,t.container.scrollLeft=0,mxUtils.hasScrollbars(t.container)||t.view.setTranslate(0,0)},EditorUi.prototype.setPageVisible=function(t){var e=this.editor.graph,i=mxUtils.hasScrollbars(e.container),n=0,o=0;if(i&&(n=e.view.translate.x*e.view.scale-e.container.scrollLeft,o=e.view.translate.y*e.view.scale-e.container.scrollTop),e.pageVisible=t,e.pageBreaksVisible=t,e.preferPageSize=t,e.view.validateBackground(),i){var r=e.getSelectionCells();e.clearSelection(),e.setSelectionCells(r)}e.sizeDidChange(),i&&(e.container.scrollLeft=e.view.translate.x*e.view.scale-n,e.container.scrollTop=e.view.translate.y*e.view.scale-o),e.defaultPageVisible=t,this.fireEvent(new mxEventObject("pageViewChanged"))},ChangeGridColor.prototype.execute=function(){var t=this.ui.editor.graph.view.gridColor;this.ui.setGridColor(this.color),this.color=t},function(){var t=new mxObjectCodec(new ChangeGridColor,["ui"]);mxCodecRegistry.register(t)}(),ChangePageSetup.prototype.execute=function(){var t=this.ui.editor.graph;if(!this.ignoreColor){this.color=this.previousColor;var e=t.background;this.ui.setBackgroundColor(this.previousColor),this.previousColor=e}if(!this.ignoreImage){this.image=this.previousImage,e=t.backgroundImage;var i=this.previousImage;null!=i&&null!=i.src&&"data:page/id,"==i.src.substring(0,13)&&(i=this.ui.createImageForPageLink(i.src,this.ui.currentPage)),this.ui.setBackgroundImage(i),this.previousImage=e}if(null!=this.previousFormat&&(this.format=this.previousFormat,e=t.pageFormat,this.previousFormat.width==e.width&&this.previousFormat.height==e.height||(this.ui.setPageFormat(this.previousFormat),this.previousFormat=e)),null!=this.foldingEnabled&&this.foldingEnabled!=this.ui.editor.graph.foldingEnabled&&(this.ui.setFoldingEnabled(this.foldingEnabled),this.foldingEnabled=!this.foldingEnabled),null!=this.previousPageScale){var n=this.ui.editor.graph.pageScale;this.previousPageScale!=n&&(this.ui.setPageScale(this.previousPageScale),this.previousPageScale=n)}},function(){var t=new mxObjectCodec(new ChangePageSetup,["ui","previousColor","previousImage","previousFormat","previousPageScale"]);t.afterDecode=function(t,e,i){return i.previousColor=i.color,i.previousImage=i.image,i.previousFormat=i.format,i.previousPageScale=i.pageScale,null!=i.foldingEnabled&&(i.foldingEnabled=!i.foldingEnabled),i},mxCodecRegistry.register(t)}(),EditorUi.prototype.setBackgroundColor=function(t){this.editor.graph.background=t,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("backgroundColorChanged"))},EditorUi.prototype.setFoldingEnabled=function(t){this.editor.graph.foldingEnabled=t,this.editor.graph.view.revalidate(),this.fireEvent(new mxEventObject("foldingEnabledChanged"))},EditorUi.prototype.setPageFormat=function(t,e){e=null!=e?e:"1"==urlParams.sketch,this.editor.graph.pageFormat=t,e||(this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct()),this.fireEvent(new mxEventObject("pageFormatChanged"))},EditorUi.prototype.setPageScale=function(t){this.editor.graph.pageScale=t,this.editor.graph.pageVisible?(this.editor.graph.view.validateBackground(),this.editor.graph.sizeDidChange()):this.actions.get("pageView").funct(),this.fireEvent(new mxEventObject("pageScaleChanged"))},EditorUi.prototype.setGridColor=function(t){this.editor.graph.view.gridColor=t,this.editor.graph.view.validateBackground(),this.fireEvent(new mxEventObject("gridColorChanged"))},EditorUi.prototype.addUndoListener=function(){var t=this.actions.get("undo"),e=this.actions.get("redo"),i=this.editor.undoManager,n=mxUtils.bind(this,(function(){t.setEnabled(this.canUndo()),e.setEnabled(this.canRedo())}));i.addListener(mxEvent.ADD,n),i.addListener(mxEvent.UNDO,n),i.addListener(mxEvent.REDO,n),i.addListener(mxEvent.CLEAR,n);var o=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){o.apply(this,arguments),n()};var r=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(t,e){r.apply(this,arguments),n()},n()},EditorUi.prototype.updateActionStates=function(){for(var t=this.editor.graph,e=this.getSelectionState(),i=t.isEnabled()&&!t.isCellLocked(t.getDefaultParent()),n=["cut","copy","bold","italic","underline","delete","duplicate","editStyle","editTooltip","editLink","backgroundColor","borderColor","edit","toFront","toBack","solid","dashed","pasteSize","dotted","fillColor","gradientColor","shadow","fontColor","formattedText","rounded","toggleRounded","sharp","strokeColor"],o=0;o<n.length;o++)this.actions.get(n[o])&&this.actions.get(n[o]).setEnabled(e.cells.length>0);this.actions.get("grid").setEnabled(!this.editor.chromeless||this.editor.editable),this.actions.get("pasteSize").setEnabled(null!=this.copiedSize&&e.vertices.length>0),this.actions.get("pasteData").setEnabled(null!=this.copiedValue&&e.cells.length>0),this.actions.get("setAsDefaultStyle").setEnabled(1==t.getSelectionCount()),this.actions.get("copySize").setEnabled(1==t.getSelectionCount()),this.actions.get("lockUnlock").setEnabled(!t.isSelectionEmpty()),this.actions.get("bringForward").setEnabled(1==e.cells.length),this.actions.get("sendBackward").setEnabled(1==e.cells.length),this.actions.get("rotation").setEnabled(1==e.vertices.length),this.actions.get("wordWrap").setEnabled(1==e.vertices.length),this.actions.get("autosize").setEnabled(1==e.vertices.length),this.actions.get("clearWaypoints").setEnabled(e.connections),this.actions.get("curved").setEnabled(e.edges.length>0),this.actions.get("turn").setEnabled(e.resizable),this.actions.get("group").setEnabled(!e.row&&!e.cell&&(e.cells.length>1||1==e.vertices.length&&0==t.model.getChildCount(e.cells[0])&&!t.isContainer(e.vertices[0]))),this.actions.get("ungroup").setEnabled(!e.row&&!e.cell&&!e.table&&e.vertices.length>0&&(t.isContainer(e.vertices[0])||t.getModel().getChildCount(e.vertices[0])>0)),this.actions.get("removeFromGroup").setEnabled(1==e.cells.length&&t.getModel().isVertex(t.getModel().getParent(e.cells[0]))),this.actions.get("collapsible").setEnabled(1==e.vertices.length&&(t.model.getChildCount(e.vertices[0])>0||t.isContainer(e.vertices[0]))),this.actions.get("exitGroup").setEnabled(null!=t.view.currentRoot),this.actions.get("home").setEnabled(null!=t.view.currentRoot),this.actions.get("enterGroup").setEnabled(1==e.cells.length&&t.isValidRoot(e.cells[0])),this.actions.get("editLink").setEnabled(1==e.cells.length),this.actions.get("openLink").setEnabled(1==e.cells.length&&null!=t.getLinkForCell(e.cells[0])),this.actions.get("guides").setEnabled(t.isEnabled()),this.actions.get("selectVertices").setEnabled(i),this.actions.get("selectEdges").setEnabled(i),this.actions.get("selectAll").setEnabled(i),this.actions.get("selectNone").setEnabled(i);var r=1==e.vertices.length&&t.isCellFoldable(e.vertices[0]);this.actions.get("expand").setEnabled(r),this.actions.get("collapse").setEnabled(r),this.menus.get("navigation").setEnabled(e.cells.length>0||null!=t.view.currentRoot),this.menus.get("layout").setEnabled(i),this.menus.get("insert").setEnabled(i),this.menus.get("direction").setEnabled(e.unlocked&&1==e.vertices.length),this.menus.get("distribute").setEnabled(e.unlocked&&e.vertices.length>1),this.menus.get("align").setEnabled(e.unlocked&&e.vertices.length>1),this.updatePasteActionStates()},EditorUi.prototype.zeroOffset=new mxPoint(0,0),EditorUi.prototype.getDiagramContainerOffset=function(){return this.zeroOffset},EditorUi.prototype.refresh=function(t){t=null==t||t;var e=this.container.clientWidth,i=this.container.clientHeight;this.container==document.body&&(e=document.body.clientWidth||document.documentElement.clientWidth,i=document.documentElement.clientHeight);var n=0;mxClient.IS_IOS&&!window.navigator.standalone&&window.innerHeight!=document.documentElement.clientHeight&&(n=document.documentElement.clientHeight-window.innerHeight,window.scrollTo(0,0));var o=Math.max(0,Math.min(this.hsplitPosition,e-this.splitSize-20)),r=0;null!=this.menubar&&(this.menubarContainer.style.height=this.menubarHeight+"px",r+=this.menubarHeight),null!=this.toolbar&&(this.toolbarContainer.style.top=this.menubarHeight+"px",this.toolbarContainer.style.height=this.toolbarHeight+"px",r+=this.toolbarHeight),r>0&&(r+=1);var l=0;if(null!=this.sidebarFooterContainer){var s=this.footerHeight+n;l=Math.max(0,Math.min(i-r-s,this.sidebarFooterHeight)),this.sidebarFooterContainer.style.width=o+"px",this.sidebarFooterContainer.style.height=l+"px",this.sidebarFooterContainer.style.bottom=s+"px"}var a=null!=this.format?this.formatWidth:0;this.sidebarContainer.style.top=r+"px",this.sidebarContainer.style.width=o+"px",this.formatContainer.style.top=r+"px",this.formatContainer.style.width=a+"px",this.formatContainer.style.display=null!=this.format?"":"none";var d=this.getDiagramContainerOffset(),h=null!=this.hsplit.parentNode?o+this.splitSize:0;this.footerContainer.style.height=this.footerHeight+"px",this.hsplit.style.top=this.sidebarContainer.style.top,this.hsplit.style.bottom=this.footerHeight+n+"px",this.hsplit.style.left=o+"px",this.footerContainer.style.display=0==this.footerHeight?"none":"",null!=this.tabContainer&&(this.tabContainer.style.left=h+"px"),this.footerHeight>0&&(this.footerContainer.style.bottom=n+"px");var c=0;null!=this.tabContainer&&(this.tabContainer.style.bottom=this.footerHeight+n+"px",this.tabContainer.style.right=this.diagramContainer.style.right,c=this.tabContainer.clientHeight),this.sidebarContainer.style.bottom=this.footerHeight+l+n+"px",this.formatContainer.style.bottom=this.footerHeight+n+"px","1"!=urlParams.embedInline&&(this.diagramContainer.style.left=h+d.x+"px",this.diagramContainer.style.top=r+d.y+"px",this.diagramContainer.style.right=a+"px",this.diagramContainer.style.bottom=this.footerHeight+n+c+"px"),t&&this.editor.graph.sizeDidChange()},EditorUi.prototype.createTabContainer=function(){return null},EditorUi.prototype.createDivs=function(){this.menubarContainer=this.createDiv("geMenubarContainer"),this.toolbarContainer=this.createDiv("geToolbarContainer"),this.sidebarContainer=this.createDiv("geSidebarContainer"),this.formatContainer=this.createDiv("geSidebarContainer geFormatContainer"),this.diagramContainer=this.createDiv("geDiagramContainer"),this.footerContainer=this.createDiv("geFooterContainer"),this.hsplit=this.createDiv("geHsplit"),this.hsplit.setAttribute("title",mxResources.get("collapseExpand")),this.menubarContainer.style.top="0px",this.menubarContainer.style.left="0px",this.menubarContainer.style.right="0px",this.toolbarContainer.style.left="0px",this.toolbarContainer.style.right="0px",this.sidebarContainer.style.left="0px",this.formatContainer.style.right="0px",this.formatContainer.style.zIndex="1",this.diagramContainer.style.right=(null!=this.format?this.formatWidth:0)+"px",this.footerContainer.style.left="0px",this.footerContainer.style.right="0px",this.footerContainer.style.bottom="0px",this.footerContainer.style.zIndex=mxPopupMenu.prototype.zIndex-3,this.hsplit.style.width=this.splitSize+"px",this.sidebarFooterContainer=this.createSidebarFooterContainer(),this.sidebarFooterContainer&&(this.sidebarFooterContainer.style.left="0px"),this.editor.chromeless?this.diagramContainer.style.border="none":this.tabContainer=this.createTabContainer()},EditorUi.prototype.createSidebarFooterContainer=function(){return null},EditorUi.prototype.createUi=function(){this.menubar=this.editor.chromeless?null:this.menus.createMenubar(this.createDiv("geMenubar")),null!=this.menubar&&this.menubarContainer.appendChild(this.menubar.container),null!=this.menubar&&(this.statusContainer=this.createStatusContainer(),this.editor.addListener("statusChanged",mxUtils.bind(this,(function(){this.setStatusText(this.editor.getStatus())}))),this.setStatusText(this.editor.getStatus()),this.menubar.container.appendChild(this.statusContainer),this.container.appendChild(this.menubarContainer)),this.sidebar=this.editor.chromeless?null:this.createSidebar(this.sidebarContainer),null!=this.sidebar&&this.container.appendChild(this.sidebarContainer),this.format=this.editor.chromeless||!this.formatEnabled?null:this.createFormat(this.formatContainer),null!=this.format&&this.container.appendChild(this.formatContainer);var t=this.editor.chromeless?null:this.createFooter();null!=t&&(this.footerContainer.appendChild(t),this.container.appendChild(this.footerContainer)),null!=this.sidebar&&this.sidebarFooterContainer&&this.container.appendChild(this.sidebarFooterContainer),this.container.appendChild(this.diagramContainer),null!=this.container&&null!=this.tabContainer&&this.container.appendChild(this.tabContainer),this.toolbar=this.editor.chromeless?null:this.createToolbar(this.createDiv("geToolbar")),null!=this.toolbar&&(this.toolbarContainer.appendChild(this.toolbar.container),this.container.appendChild(this.toolbarContainer)),null!=this.sidebar&&(this.container.appendChild(this.hsplit),this.addSplitHandler(this.hsplit,!0,0,mxUtils.bind(this,(function(t){this.hsplitPosition=t,this.refresh()}))))},EditorUi.prototype.createStatusContainer=function(){var t=document.createElement("a");return t.className="geItem geStatus",t},EditorUi.prototype.setStatusText=function(t){this.statusContainer.innerHTML=t},EditorUi.prototype.createToolbar=function(t){return new Toolbar(this,t)},EditorUi.prototype.createSidebar=function(t){return new Sidebar(this,t)},EditorUi.prototype.createFormat=function(t){return new Format(this,t)},EditorUi.prototype.createFooter=function(){return this.createDiv("geFooter")},EditorUi.prototype.createDiv=function(t){var e=document.createElement("div");return e.className=t,e},EditorUi.prototype.addSplitHandler=function(t,e,i,n){var o=null,r=null,l=!0,s=null;mxClient.IS_POINTER&&(t.style.touchAction="none");var a=mxUtils.bind(this,(function(){var n=parseInt(e?t.style.left:t.style.bottom);return e||(n=n+i-this.footerHeight),n}));function d(t){if(null!=o){var d=new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t));n(Math.max(0,r+(e?d.x-o.x:o.y-d.y)-i)),mxEvent.consume(t),r!=a()&&(l=!0,s=null)}}function h(t){d(t),r=null,o=null}mxEvent.addGestureListeners(t,(function(t){o=new mxPoint(mxEvent.getClientX(t),mxEvent.getClientY(t)),r=a(),l=!1,mxEvent.consume(t)})),mxEvent.addListener(t,"click",mxUtils.bind(this,(function(t){if(!l&&this.hsplitClickEnabled){var e=null!=s?s-i:0;s=a(),n(e),mxEvent.consume(t)}}))),mxEvent.addGestureListeners(document,null,d,h),this.destroyFunctions.push((function(){mxEvent.removeGestureListeners(document,null,d,h)}))},EditorUi.prototype.handleError=function(t,e,i,n,o){var r=null!=t&&null!=t.error?t.error:t;if(null!=r||null!=e){var l=mxUtils.htmlEntities(mxResources.get("unknownError")),s=mxResources.get("ok");e=null!=e?e:mxResources.get("error"),null!=r&&null!=r.message&&(l=mxUtils.htmlEntities(r.message)),this.showError(e,l,s,i,null,null,null,null,null,null,null,null,n?i:null)}else null!=i&&i()},EditorUi.prototype.showError=function(t,e,i,n,o,r,l,s,a,d,h,c,u){var g=new ErrorDialog(this,t,e,i||mxResources.get("ok"),n,o,r,l,c,s,a),m=Math.ceil(null!=e?e.length/50:1);this.showDialog(g.container,d||340,h||100+20*m,!0,!1,u),g.init()},EditorUi.prototype.showDialog=function(t,e,i,n,o,r,l,s,a,d){this.editor.graph.tooltipHandler.resetTimer(),this.editor.graph.tooltipHandler.hideTooltip(),null==this.dialogs&&(this.dialogs=[]),this.dialog=new Dialog(this,t,e,i,n,o,r,l,s,a,d),this.dialogs.push(this.dialog)},EditorUi.prototype.hideDialog=function(t,e,i){if(null!=this.dialogs&&this.dialogs.length>0){if(null!=i&&i!=this.dialog.container.firstChild)return;var n=this.dialogs.pop();if(0==n.close(t,e))return void this.dialogs.push(n);this.dialog=this.dialogs.length>0?this.dialogs[this.dialogs.length-1]:null,this.editor.fireEvent(new mxEventObject("hideDialog")),null==this.dialog&&"hidden"!=this.editor.graph.container.style.visibility&&window.setTimeout(mxUtils.bind(this,(function(){this.editor.graph.isEditing()&&null!=this.editor.graph.cellEditor.textarea?this.editor.graph.cellEditor.textarea.focus():(mxUtils.clearSelection(),this.editor.graph.container.focus())})),0)}},EditorUi.prototype.ctrlEnter=function(){var t=this.editor.graph;if(t.isEnabled())try{for(var e=t.getSelectionCells(),i=new mxDictionary,n=[],o=0;o<e.length;o++){var r=t.isTableCell(e[o])?t.model.getParent(e[o]):e[o];null==r||i.get(r)||(i.put(r,!0),n.push(r))}t.setSelectionCells(t.duplicateCells(n,!1))}catch(t){this.handleError(t)}},EditorUi.prototype.pickColor=function(t,e){var i=this.editor.graph,n=i.cellEditor.saveSelection(),o=230+17*(Math.ceil(ColorDialog.prototype.presetColors.length/12)+Math.ceil(ColorDialog.prototype.defaultColors.length/12)),r=new ColorDialog(this,mxUtils.rgba2hex(t)||"none",(function(t){i.cellEditor.restoreSelection(n),e(t)}),(function(){i.cellEditor.restoreSelection(n)}));this.showDialog(r.container,230,o,!0,!1),r.init()},EditorUi.prototype.openFile=function(){window.openFile=new OpenFile(mxUtils.bind(this,(function(t){this.hideDialog(t)}))),this.showDialog(new OpenDialog(this).container,Editor.useLocalStorage?640:320,Editor.useLocalStorage?480:220,!0,!0,(function(){window.openFile=null}))},EditorUi.prototype.extractGraphModelFromHtml=function(t){var e=null;try{var i=t.indexOf("&lt;mxGraphModel ");if(i>=0){var n=t.lastIndexOf("&lt;/mxGraphModel&gt;");n>i&&(e=t.substring(i,n+21).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/\\&quot;/g,'"').replace(/\n/g,""))}}catch(t){}return e},EditorUi.prototype.readGraphModelFromClipboard=function(t){this.readGraphModelFromClipboardWithType(mxUtils.bind(this,(function(e){null!=e?t(e):this.readGraphModelFromClipboardWithType(mxUtils.bind(this,(function(e){if(null!=e){var i=decodeURIComponent(e);this.isCompatibleString(i)&&(e=i)}t(e)})),"text")})),"html")},EditorUi.prototype.readGraphModelFromClipboardWithType=function(t,e){navigator.clipboard.read().then(mxUtils.bind(this,(function(i){null!=i&&i.length>0&&"html"==e&&mxUtils.indexOf(i[0].types,"text/html")>=0?i[0].getType("text/html").then(mxUtils.bind(this,(function(e){e.text().then(mxUtils.bind(this,(function(e){try{var i=this.parseHtmlData(e),n="text/plain"!=i.getAttribute("data-type")?i.innerHTML:mxUtils.trim(null==i.innerText?mxUtils.getTextContent(i):i.innerText);try{var o=n.lastIndexOf("%3E");o>=0&&o<n.length-3&&(n=n.substring(0,o+3))}catch(t){}try{var r=i.getElementsByTagName("span"),l=null!=r&&r.length>0?mxUtils.trim(decodeURIComponent(r[0].textContent)):decodeURIComponent(n);this.isCompatibleString(l)&&(n=l)}catch(t){}}catch(t){}t(this.isCompatibleString(n)?n:null)}))).catch((function(e){t(null)}))}))).catch((function(e){t(null)})):null!=i&&i.length>0&&"text"==e&&mxUtils.indexOf(i[0].types,"text/plain")>=0?i[0].getType("text/plain").then((function(e){e.text().then((function(e){t(e)})).catch((function(){t(null)}))})).catch((function(){t(null)})):t(null)}))).catch((function(e){t(null)}))},EditorUi.prototype.parseHtmlData=function(t){var e=null;if(null!=t&&t.length>0){var i="<meta "==t.substring(0,6);(e=document.createElement("div")).innerHTML=(i?'<meta charset="utf-8">':"")+this.editor.graph.sanitizeHtml(t),asHtml=!0;var n=e.getElementsByTagName("style");if(null!=n)for(;n.length>0;)n[0].parentNode.removeChild(n[0]);if(null!=e.firstChild&&e.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT&&null!=e.firstChild.nextSibling&&e.firstChild.nextSibling.nodeType==mxConstants.NODETYPE_ELEMENT&&"META"==e.firstChild.nodeName&&"A"==e.firstChild.nextSibling.nodeName&&null==e.firstChild.nextSibling.nextSibling&&(r=null==e.firstChild.nextSibling.innerText?mxUtils.getTextContent(e.firstChild.nextSibling):e.firstChild.nextSibling.innerText)==e.firstChild.nextSibling.getAttribute("href")&&(mxUtils.setTextContent(e,r),asHtml=!1),null!=(o=i&&null!=e.firstChild?e.firstChild.nextSibling:e.firstChild)&&null==o.nextSibling&&o.nodeType==mxConstants.NODETYPE_ELEMENT&&"IMG"==o.nodeName)null!=(r=o.getAttribute("src"))&&(Editor.isPngDataUrl(r)&&null!=(l=Editor.extractGraphModelFromPng(r))&&l.length>0&&(r=l),mxUtils.setTextContent(e,r),asHtml=!1);else{var o,r,l,s=e.getElementsByTagName("img");if(1==s.length&&null!=(r=(o=s[0]).getAttribute("src"))&&o.parentNode==e&&1==e.children.length)Editor.isPngDataUrl(r)&&null!=(l=Editor.extractGraphModelFromPng(r))&&l.length>0&&(r=l),mxUtils.setTextContent(e,r),asHtml=!1}asHtml&&Graph.removePasteFormatting(e)}return asHtml||e.setAttribute("data-type","text/plain"),e},EditorUi.prototype.extractGraphModelFromEvent=function(t){var e=null,i=null;if(null!=t){var n=null!=t.dataTransfer?t.dataTransfer:t.clipboardData;if(null!=n&&(10==document.documentMode||11==document.documentMode?i=n.getData("Text"):(i=mxUtils.indexOf(n.types,"text/html")>=0?n.getData("text/html"):null,mxUtils.indexOf(n.types,null==i||0==i.length)&&(i=n.getData("text/plain"))),null!=i)){i=Graph.zapGremlins(mxUtils.trim(i));var o=this.extractGraphModelFromHtml(i);null!=o&&(i=o)}}return null!=i&&this.isCompatibleString(i)&&(e=i),e},EditorUi.prototype.isCompatibleString=function(t){return!1},EditorUi.prototype.saveFile=function(t){if(t||null==this.editor.filename){var e=new FilenameDialog(this,this.editor.getOrCreateFilename(),mxResources.get("save"),mxUtils.bind(this,(function(t){this.save(t)})),null,mxUtils.bind(this,(function(t){return null!=t&&t.length>0||(mxUtils.confirm(mxResources.get("invalidName")),!1)})));this.showDialog(e.container,300,100,!0,!0),e.init()}else this.save(this.editor.getOrCreateFilename())},EditorUi.prototype.save=function(t){if(null!=t){this.editor.graph.isEditing()&&this.editor.graph.stopEditing();var e=mxUtils.getXml(this.editor.getGraphXml());try{if(Editor.useLocalStorage){if(null!=localStorage.getItem(t)&&!mxUtils.confirm(mxResources.get("replaceIt",[t])))return;localStorage.setItem(t,e),this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("saved"))+" "+new Date)}else{if(!(e.length<MAX_REQUEST_SIZE))return mxUtils.alert(mxResources.get("drawingTooLarge")),void mxUtils.popup(e);new mxXmlRequest(SAVE_URL,"filename="+encodeURIComponent(t)+"&xml="+encodeURIComponent(e)).simulate(document,"_blank")}this.editor.setModified(!1),this.editor.setFilename(t),this.updateDocumentTitle()}catch(t){this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("errorSavingFile")))}}},EditorUi.prototype.executeLayout=function(t,e,i){var n=this.editor.graph;if(n.isEnabled()){n.getModel().beginUpdate();try{t()}catch(t){throw t}finally{if(this.allowAnimation&&e&&(null==navigator.userAgent||navigator.userAgent.indexOf("Camino")<0)){var o=new mxMorphing(n);o.addListener(mxEvent.DONE,mxUtils.bind(this,(function(){n.getModel().endUpdate(),null!=i&&i()}))),o.startAnimation()}else n.getModel().endUpdate(),null!=i&&i()}}},EditorUi.prototype.showImageDialog=function(t,e,i,n){var o=this.editor.graph.cellEditor,r=o.saveSelection(),l=mxUtils.prompt(t,e);if(o.restoreSelection(r),null!=l&&l.length>0){var s=new Image;s.onload=function(){i(l,s.width,s.height)},s.onerror=function(){i(null),mxUtils.alert(mxResources.get("fileNotFound"))},s.src=l}else i(null)},EditorUi.prototype.showLinkDialog=function(t,e,i){var n=new LinkDialog(this,t,e,i);this.showDialog(n.container,420,90,!0,!0),n.init()},EditorUi.prototype.showDataDialog=function(t){if(null!=t){var e=new EditDataDialog(this,t);this.showDialog(e.container,480,420,!0,!1,null,!1),e.init()}},EditorUi.prototype.showBackgroundImageDialog=function(t,e){t=null!=t?t:mxUtils.bind(this,(function(t){var e=new ChangePageSetup(this,null,t);e.ignoreColor=!0,this.editor.graph.model.execute(e)}));var i=mxUtils.prompt(mxResources.get("backgroundImage"),null!=e?e.src:"");null!=i&&i.length>0?((e=new Image).onload=function(){t(new mxImage(i,e.width,e.height),!1)},e.onerror=function(){t(null,!0),mxUtils.alert(mxResources.get("fileNotFound"))},e.src=i):t(null)},EditorUi.prototype.setBackgroundImage=function(t){this.editor.graph.setBackgroundImage(t),this.editor.graph.view.validateBackgroundImage(),this.fireEvent(new mxEventObject("backgroundImageChanged"))},EditorUi.prototype.confirm=function(t,e,i){mxUtils.confirm(t)?null!=e&&e():null!=i&&i()},EditorUi.prototype.createOutline=function(t){var e=new mxOutline(this.editor.graph);return mxEvent.addListener(window,"resize",(function(){e.update(!1)})),e},EditorUi.prototype.altShiftActions={67:"clearWaypoints",65:"connectionArrows",76:"editLink",80:"connectionPoints",84:"editTooltip",86:"pasteSize",88:"copySize",66:"copyData",69:"pasteData"},EditorUi.prototype.createKeyHandler=function(t){var e=this,i=this.editor.graph,n=new mxKeyHandler(i),o=n.isEventIgnored;n.isEventIgnored=function(t){return!(mxEvent.isShiftDown(t)&&9==t.keyCode)&&(!this.isControlDown(t)||mxEvent.isShiftDown(t)||90!=t.keyCode&&89!=t.keyCode&&188!=t.keyCode&&190!=t.keyCode&&85!=t.keyCode)&&(66!=t.keyCode&&73!=t.keyCode||!this.isControlDown(t)||this.graph.cellEditor.isContentEditing()&&!mxClient.IS_FF&&!mxClient.IS_SF)&&o.apply(this,arguments)},n.isEnabledForEvent=function(t){return!mxEvent.isConsumed(t)&&this.isGraphEvent(t)&&this.isEnabled()&&(null==e.dialogs||0==e.dialogs.length)},n.isControlDown=function(t){return mxEvent.isControlDown(t)||mxClient.IS_MAC&&t.metaKey};var r=null;function l(t,e,n){if(!i.isSelectionEmpty()&&i.isEnabled())if(e=null!=e?e:1,n){i.getModel().beginUpdate();try{for(var o=i.getSelectionCells(),l=0;l<o.length;l++)if(i.getModel().isVertex(o[l])&&i.isCellResizable(o[l])){var s=i.getCellGeometry(o[l]);null!=s&&(s=s.clone(),37==t?s.width=Math.max(0,s.width-e):38==t?s.height=Math.max(0,s.height-e):39==t?s.width+=e:40==t&&(s.height+=e),i.getModel().setGeometry(o[l],s))}}finally{i.getModel().endUpdate()}}else{var a=i.getSelectionCell(),d=i.model.getParent(a),h=i.getView().scale,c=null;if(1==i.getSelectionCount()&&i.model.isVertex(a)&&null!=i.layoutManager&&!i.isCellLocked(a)&&(c=i.layoutManager.getLayout(d)),null!=c&&c.constructor==mxStackLayout){var u=d.getIndex(a);37==t||38==t?i.model.add(d,a,Math.max(0,u-1)):39!=t&&40!=t||i.model.add(d,a,Math.min(i.model.getChildCount(d),u+1))}else{var g=i.graphHandler;if(null!=g){if(null==g.first&&g.start(i.getSelectionCell(),0,0,i.getSelectionCells()),null!=g.first){var m=0,p=0;37==t?m=-e:38==t?p=-e:39==t?m=e:40==t&&(p=e),g.currentDx+=m*h,g.currentDy+=p*h,g.checkPreview(),g.updatePreview()}null!=r&&window.clearTimeout(r),r=window.setTimeout((function(){if(null!=g.first){var t=g.roundLength(g.currentDx/h),e=g.roundLength(g.currentDy/h);g.moveCells(g.cells,t,e),g.reset()}}),400)}}}}var s={37:mxConstants.DIRECTION_WEST,38:mxConstants.DIRECTION_NORTH,39:mxConstants.DIRECTION_EAST,40:mxConstants.DIRECTION_SOUTH},a=n.getFunction;mxKeyHandler.prototype.getFunction=function(t){if(i.isEnabled()){if(mxEvent.isShiftDown(t)&&mxEvent.isAltDown(t)){var n=e.actions.get(e.altShiftActions[t.keyCode]);if(null!=n)return n.funct}if(null!=s[t.keyCode]&&!i.isSelectionEmpty()){if(this.isControlDown(t)||!mxEvent.isShiftDown(t)||!mxEvent.isAltDown(t))return this.isControlDown(t)?function(){l(t.keyCode,mxEvent.isShiftDown(t)?i.gridSize:null,!0)}:function(){l(t.keyCode,mxEvent.isShiftDown(t)?i.gridSize:null)};if(i.model.isVertex(i.getSelectionCell()))return function(){var n=i.connectVertex(i.getSelectionCell(),s[t.keyCode],i.defaultEdgeLength,t,!0);null!=n&&n.length>0&&(1==n.length&&i.model.isEdge(n[0])?i.setSelectionCell(i.model.getTerminal(n[0],!1)):i.setSelectionCell(n[n.length-1]),i.scrollCellToVisible(i.getSelectionCell()),null!=e.hoverIcons&&e.hoverIcons.update(i.view.getState(i.getSelectionCell())))}}}return a.apply(this,arguments)},n.bindAction=mxUtils.bind(this,(function(t,e,i,o){var r=this.actions.get(i);if(null!=r){var l=function(){r.isEnabled()&&r.funct()};e?o?n.bindControlShiftKey(t,l):n.bindControlKey(t,l):o?n.bindShiftKey(t,l):n.bindKey(t,l)}}));var d=this,h=n.escape;return n.escape=function(t){h.apply(this,arguments)},n.enter=function(){},n.bindControlShiftKey(36,(function(){i.exitGroup()})),n.bindControlShiftKey(35,(function(){i.enterGroup()})),n.bindShiftKey(36,(function(){i.home()})),n.bindKey(35,(function(){i.refresh()})),n.bindAction(107,!0,"zoomIn"),n.bindAction(109,!0,"zoomOut"),n.bindAction(80,!0,"print"),n.bindAction(79,!0,"outline",!0),this.editor.chromeless&&!this.editor.editable||(n.bindControlKey(36,(function(){i.isEnabled()&&i.foldCells(!0)})),n.bindControlKey(35,(function(){i.isEnabled()&&i.foldCells(!1)})),n.bindControlKey(13,(function(){d.ctrlEnter()})),n.bindAction(8,!1,"delete"),n.bindAction(8,!0,"deleteAll"),n.bindAction(8,!1,"deleteLabels",!0),n.bindAction(46,!1,"delete"),n.bindAction(46,!0,"deleteAll"),n.bindAction(46,!1,"deleteLabels",!0),n.bindAction(36,!1,"resetView"),n.bindAction(72,!0,"fitWindow",!0),n.bindAction(74,!0,"fitPage"),n.bindAction(74,!0,"fitTwoPages",!0),n.bindAction(48,!0,"customZoom"),n.bindAction(82,!0,"turn"),n.bindAction(82,!0,"clearDefaultStyle",!0),n.bindAction(83,!0,"save"),n.bindAction(83,!0,"saveAs",!0),n.bindAction(65,!0,"selectAll"),n.bindAction(65,!0,"selectNone",!0),n.bindAction(73,!0,"selectVertices",!0),n.bindAction(69,!0,"selectEdges",!0),n.bindAction(69,!0,"editStyle"),n.bindAction(66,!0,"bold"),n.bindAction(66,!0,"toBack",!0),n.bindAction(70,!0,"toFront",!0),n.bindAction(68,!0,"duplicate"),n.bindAction(68,!0,"setAsDefaultStyle",!0),n.bindAction(90,!0,"undo"),n.bindAction(89,!0,"autosize",!0),n.bindAction(88,!0,"cut"),n.bindAction(67,!0,"copy"),n.bindAction(86,!0,"paste"),n.bindAction(71,!0,"group"),n.bindAction(77,!0,"editData"),n.bindAction(71,!0,"grid",!0),n.bindAction(73,!0,"italic"),n.bindAction(76,!0,"lockUnlock"),n.bindAction(76,!0,"layers",!0),n.bindAction(80,!0,"formatPanel",!0),n.bindAction(85,!0,"underline"),n.bindAction(85,!0,"ungroup",!0),n.bindAction(190,!0,"superscript"),n.bindAction(188,!0,"subscript"),n.bindAction(13,!1,"keyPressEnter"),n.bindKey(113,(function(){i.isEnabled()&&i.startEditingAtCell()}))),mxClient.IS_WIN?n.bindAction(89,!0,"redo"):n.bindAction(90,!0,"redo",!0),n},EditorUi.prototype.destroy=function(){var t=this.editor.graph;if(null!=t&&null!=this.selectionStateListener&&(t.getSelectionModel().removeListener(mxEvent.CHANGE,this.selectionStateListener),t.getModel().removeListener(mxEvent.CHANGE,this.selectionStateListener),t.removeListener(mxEvent.EDITING_STARTED,this.selectionStateListener),t.removeListener(mxEvent.EDITING_STOPPED,this.selectionStateListener),t.getView().removeListener("unitChanged",this.selectionStateListener),this.selectionStateListener=null),null!=this.editor&&(this.editor.destroy(),this.editor=null),null!=this.menubar&&(this.menubar.destroy(),this.menubar=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),null!=this.sidebar&&(this.sidebar.destroy(),this.sidebar=null),null!=this.keyHandler&&(this.keyHandler.destroy(),this.keyHandler=null),null!=this.keydownHandler&&(mxEvent.removeListener(document,"keydown",this.keydownHandler),this.keydownHandler=null),null!=this.keyupHandler&&(mxEvent.removeListener(document,"keyup",this.keyupHandler),this.keyupHandler=null),null!=this.resizeHandler&&(mxEvent.removeListener(window,"resize",this.resizeHandler),this.resizeHandler=null),null!=this.gestureHandler&&(mxEvent.removeGestureListeners(document,this.gestureHandler),this.gestureHandler=null),null!=this.orientationChangeHandler&&(mxEvent.removeListener(window,"orientationchange",this.orientationChangeHandler),this.orientationChangeHandler=null),null!=this.scrollHandler&&(mxEvent.removeListener(window,"scroll",this.scrollHandler),this.scrollHandler=null),null!=this.destroyFunctions){for(var e=0;e<this.destroyFunctions.length;e++)this.destroyFunctions[e]();this.destroyFunctions=null}var i=[this.menubarContainer,this.toolbarContainer,this.sidebarContainer,this.formatContainer,this.diagramContainer,this.footerContainer,this.chromelessToolbar,this.hsplit,this.sidebarFooterContainer,this.layersDialog];for(e=0;e<i.length;e++)null!=i[e]&&null!=i[e].parentNode&&i[e].parentNode.removeChild(i[e])};